
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user 16-core network, expiring  2 Jul 2026
Serial number: 501909320077
  Licensed to: Michael Droste
               Stanford University GSB

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running /Users/Mike/Documents/Stata/profile.do ...

. do test_manual_cc.do 

. * Manually compute canonical correlations for Test 4
. clear all

. set more off

. adopath ++ "build"
  [1]              "build"
  [2]  (BASE)      "/Applications/Stata/ado/base/"
  [3]  (SITE)      "/Applications/Stata/ado/site/"
  [4]              "."
  [5]  (PERSONAL)  "/Users/Mike/Documents/Stata/ado/personal/"
  [6]  (PLUS)      "/Users/Mike/Library/Application Support/Stata/ado/plus/"
  [7]  (OLDPLACE)  "~/ado/"

. 
. sysuse auto, clear
(1978 automobile data)

. 
. * Absorb foreign FE manually (demean by foreign)
. foreach v in price mpg weight length turn displacement {
  2.     bys foreign: egen mean_`v' = mean(`v')
  3.     gen `v'_dm = `v' - mean_`v'
  4. }

. 
. * Y = endogenous (mpg, weight) after demeaning
. * Z = excluded instruments (length, turn, displacement) after demeaning
. 
. * Compute Y'Y
. mat accum YtY = mpg_dm weight_dm, noconstant
(obs=74)

. mat list YtY

symmetric YtY[2,2]
               mpg_dm   weight_dm
   mpg_dm   2065.3059
weight_dm  -188396.42    28597399

. 
. * Compute Z'Z
. mat accum ZtZ = length_dm turn_dm displacement_dm, noconstant
(obs=74)

. mat list ZtZ

symmetric ZtZ[3,3]
                 length_dm       turn_dm  displaceme~m
   length_dm     24425.512
     turn_dm     3606.9948      850.1451
displaceme~m     72425.292     11485.589     383758.54

. 
. * Compute Y'Z
. mat accum YtZ_full = mpg_dm weight_dm length_dm turn_dm displacement_dm, noco
> nstant
(obs=74)

. mat YtZ = YtZ_full[1..2, 3..5]

. mat list YtZ

YtZ[2,3]
              length_dm       turn_dm  displaceme~m
   mpg_dm    -5374.0612    -874.97378     -18004.46
weight_dm     768049.28     120633.16     2766937.2

. 
. * Compute eigenvalues: inv(Y'Y) * Y'Z * inv(Z'Z) * Z'Y
. mat ZtZ_inv = inv(ZtZ)

. mat YtZ_ZtZ_inv = YtZ * ZtZ_inv

. mat temp = YtZ_ZtZ_inv * YtZ'

. mat C = inv(YtY) * temp

. mat list C

C[2,2]
               mpg_dm   weight_dm
   mpg_dm   .07760083  -8.6750623
weight_dm  -.00564684   .83965503

. 
. * Eigenvalues of C
. mat symeigen eigvec eigval = C
matrix not symmetric
r(505);

end of do-file
r(505);

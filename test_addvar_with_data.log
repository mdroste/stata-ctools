
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user 16-core network, expiring  2 Jul 2026
Serial number: 501909320077
  Licensed to: Michael Droste
               Stanford University GSB

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running /Users/Mike/Documents/Stata/profile.do ...

. do test_addvar_with_data.do 

. * Test addvar performance with existing data
. clear all

. set more off

. 
. local classpath "/Users/Mike/Documents/GitHub/stata-ctools"

. 
. * Create dataset WITH data (like cmerge scenario) - 100M obs, 20 existing var
> s
. set obs 100000000
Number of observations (_N) was 0, now 100,000,000.

. forval i = 1/20 {
  2.     gen x`i' = rnormal()
  3. }

. gen g = ceil(runiform()*100000)

. 
. di "Dataset has " c(k) " variables, " _N " observations"
Dataset has 21 variables, 1.000e+08 observations

. 
. * 24 new variables to create
. local types "long+double+double+double+double+double+double+double+double+dou
> ble+double+double+double+double+double+double+double+double+double+double+dou
> ble+double+double+byte"

. local names "v0+v1+v2+v3+v4+v5+v6+v7+v8+v9+v10+v11+v12+v13+v14+v15+v16+v17+v1
> 8+v19+v20+v21+v22+v23"

. 
. * Test 1: Mata _st_addvar
. di _n "Test 1: Mata _st_addvar (24 vars)..."

Test 1: Mata _st_addvar (24 vars)...

. timer clear 1

. timer on 1

. mata: _st_addvar(("long","double","double","double","double","double","double
> ","double","double","double","double","double","double","double","double","do
> uble","double","double","double","double","double","double","double","byte"),
>  ("v0","v1","v2","v3","v4","v5","v6","v7","v8","v9","v10","v11","v12","v13","
> v14","v15","v16","v17","v18","v19","v20","v21","v22","v23"))
        1    2    3    4    5    6    7    8    9   10   11   12   13   14
    +-----------------------------------------------------------------------
  1 |  22   23   24   25   26   27   28   29   30   31   32   33   34   35
    +-----------------------------------------------------------------------
       15   16   17   18   19   20   21   22   23   24
     ---------------------------------------------------+
  1    36   37   38   39   40   41   42   43   44   45  |
     ---------------------------------------------------+

. timer off 1

. timer list 1
   1:     38.55 /        1 =      38.5460

. drop v0-v23

. 
. * Test 2: Java batch (sequential)
. di _n "Test 2: Java AddVarBatch sequential (24 vars)..."

Test 2: Java AddVarBatch sequential (24 vars)...

. timer clear 2

. timer on 2

. javacall AddVarBatch create, classpath(`classpath') args(`types' `names')

. timer off 2

. timer list 2
   2:     11.33 /        1 =      11.3310

. drop v0-v23

. 
. * Test 3: Java parallel
. di _n "Test 3: Java AddVarParallel (24 vars, " c(processors_max) " threads)..
> ."

Test 3: Java AddVarParallel (24 vars, 12 threads)...

. timer clear 3

. timer on 3

. javacall AddVarParallel create, classpath(`classpath') args(`types' `names')
AddVarParallel: 24 vars, 12 threads

. timer off 3

. timer list 3
   3:     11.24 /        1 =      11.2450

. drop v0-v23

. 
. di _n "Done!"

Done!

. 
end of do-file

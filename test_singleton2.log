
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user 16-core network, expiring  2 Jul 2026
Serial number: 501909320077
  Licensed to: Michael Droste
               Stanford University GSB

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running /Users/Mike/Documents/Stata/profile.do ...

. do /tmp/test_singleton2.do 

. clear all

. set more off

. adopath ++ build
  [1]              "build"
  [2]  (BASE)      "/Applications/Stata/ado/base/"
  [3]  (SITE)      "/Applications/Stata/ado/site/"
  [4]              "."
  [5]  (PERSONAL)  "/Users/Mike/Documents/Stata/ado/personal/"
  [6]  (PLUS)      "/Users/Mike/Library/Application Support/Stata/ado/plus/"
  [7]  (OLDPLACE)  "~/ado/"

. 
. * Singleton FE test with trace
. clear

. set seed 456

. set obs 100
Number of observations (_N) was 0, now 100.

. gen id = _n

. gen x = runiform()

. gen y = x + rnormal()

. 
. set trace on

. capture noisily creghdfe y x, absorb(id)
  ---------------------------------------------------------- begin creghdfe ---
  - version 14.0
  - syntax varlist(min=2 fv) [aw fw pw] [if] [in], Absorb(varlist) [VCE(string)
>  Verbose TIMEit TOLerance(real 1e-8) MAXiter(integer 10000) NOSTANDardize RES
> ID RESID2(name)]
  - marksample touse
  - markout `touse' `absorb'
  = markout __000000 id
  - local weight_var ""
  - local weight_type = 0
  - if "`weight'" != "" {
  = if "" != "" {
    local weight_var "`exp'"
    local weight_var = subinstr("`weight_var'", "=", "", .)
    local weight_var = trim("`weight_var'")
    if "`weight'" == "aweight" {
    local weight_type = 1
    }
    else if "`weight'" == "fweight" {
    local weight_type = 2
    capture confirm numeric variable `weight_var'
    if _rc != 0 {
    di as error "creghdfe: fweight variable must be numeric"
    exit 198
    }
    }
    else if "`weight'" == "pweight" {
    local weight_type = 3
    }
    markout `touse' `weight_var'
    qui count if `weight_var' <= 0 & `touse'
    if r(N) > 0 {
    di as error "creghdfe: weights must be positive"
    exit 198
    }
    }
  - gettoken depvar indepvars : varlist
  - local nvars : word count `varlist'
  = local nvars : word count y x
  - local nfe : word count `absorb'
  = local nfe : word count id
  - local vcetype = 0
  - local clustervar ""
  - local clustervar_orig ""
  - local clustervar_is_temp = 0
  - if `weight_type' == 3 {
  = if 0 == 3 {
    local vcetype = 1
    }
  - if `"`vce'"' != "" {
  = if `""' != "" {
    local vce_lower = lower(trim(`"`vce'"'))
    if substr("`vce_lower'", 1, 2) == "cl" {
    local vcetype = 2
    gettoken vce_type clustervar : vce
    local clustervar = trim("`clustervar'")
    if "`clustervar'" == "" {
    di as error "creghdfe: cluster variable required with vce(cluster)"
    exit 198
    }
    local clustervar_orig "`clustervar'"
    capture confirm numeric variable `clustervar'
    if _rc != 0 {
    tempvar clustervar_numeric
    capture which gegen
    if _rc == 0 {
    quietly gegen `clustervar_numeric' = group(`clustervar')
    }
    else {
    quietly egen `clustervar_numeric' = group(`clustervar')
    }
    local clustervar "`clustervar_numeric'"
    local clustervar_is_temp = 1
    }
    capture confirm numeric variable `clustervar_orig'
    if _rc == 0 {
    markout `touse' `clustervar_orig'
    }
    else {
    quietly replace `touse' = 0 if `clustervar_orig' == "" & `touse' == 1
    }
    }
    else if "`vce_lower'" == "robust" | "`vce_lower'" == "r" {
    local vcetype = 1
    }
    else if "`vce_lower'" == "unadjusted" | "`vce_lower'" == "ols" {
    local vcetype = 0
    }
    else {
    di as error "creghdfe: unrecognized vce() option"
    exit 198
    }
    }
  - qui count if `touse'
  = qui count if __000000
  - local nobs = r(N)
  - if `nobs' == 0 {
  = if 100 == 0 {
    di as error "creghdfe: no observations"
    exit 2000
    }
  - capture program list ctools_plugin
  - if _rc != 0 {
  - local __os = c(os)
  - local __machine = c(machine_type)
  - local __is_mac = 0
  - if "`__os'" == "MacOSX" {
  = if "Unix" == "MacOSX" {
    local __is_mac = 1
    }
  - else if strpos(lower("`__machine'"), "mac") > 0 {
  = else if strpos(lower("Mac (Apple Silicon)"), "mac") > 0 {
  - local __is_mac = 1
  - }
  - local __plugin = ""
  - if "`__os'" == "Windows" {
  = if "Unix" == "Windows" {
    local __plugin "ctools_windows.plugin"
    }
  - else if `__is_mac' {
  = else if 1 {
  - local __is_arm = 0
  - if strpos(lower("`__machine'"), "apple") > 0 | strpos(lower("`__machine'"),
>  "arm") > 0 | strpos(lower("`__machine'"), "silicon") > 0 {
  = if strpos(lower("Mac (Apple Silicon)"), "apple") > 0 | strpos(lower("Mac (A
> pple Silicon)"), "arm") > 0 | strpos(lower("Mac (Apple Silicon)"), "silicon")
>  > 0 {
  - local __is_arm = 1
  - }
  - if `__is_arm' == 0 {
  = if 1 == 0 {
    tempfile __archfile
    quietly shell uname -m > "`__archfile'" 2>&1
    tempname __fh
    file open `__fh' using "`__archfile'", read text
    file read `__fh' __archline
    file close `__fh'
    capture erase "`__archfile'"
    if strpos("`__archline'", "arm64") > 0 {
    local __is_arm = 1
    }
    }
  - if `__is_arm' {
  = if 1 {
  - local __plugin "ctools_mac_arm.plugin"
  - }
  - else {
    local __plugin "ctools_mac_x86.plugin"
    }
  - }
  - else if "`__os'" == "Unix" {
  = else if "Unix" == "Unix" {
    local __plugin "ctools_linux.plugin"
    }
  - else {
    local __plugin "ctools.plugin"
    }
  - capture program ctools_plugin, plugin using("`__plugin'")
  = capture program ctools_plugin, plugin using("ctools_mac_arm.plugin")
  - if _rc != 0 & _rc != 110 & "`__plugin'" != "ctools.plugin" {
  = if _rc != 0 & _rc != 110 & "ctools_mac_arm.plugin" != "ctools.plugin" {
    capture program ctools_plugin, plugin using("ctools.plugin")
    }
  - if _rc != 0 & _rc != 110 {
    di as error "creghdfe: Could not load ctools plugin"
    exit 601
    }
  - }
  - local resid_varname ""
  - local compute_resid = 0
  - if "`resid'" != "" | "`resid2'" != "" {
  = if "" != "" | "" != "" {
    local compute_resid = 1
    if "`resid2'" != "" {
    local resid_varname "`resid2'"
    }
    else {
    local resid_varname "_reghdfe_resid"
    }
    capture drop `resid_varname'
    quietly gen double `resid_varname' = .
    }
  - scalar __creghdfe_K = `nvars'
  = scalar __creghdfe_K = 2
  - scalar __creghdfe_G = `nfe'
  = scalar __creghdfe_G = 1
  - scalar __creghdfe_drop_singletons = 1
  - scalar __creghdfe_verbose = ("`verbose'" != "")
  = scalar __creghdfe_verbose = ("" != "")
  - scalar __creghdfe_maxiter = `maxiter'
  = scalar __creghdfe_maxiter = 10000
  - scalar __creghdfe_tolerance = `tolerance'
  = scalar __creghdfe_tolerance = 1.00000000000e-08
  - scalar __creghdfe_standardize = ("`nostandardize'" == "")
  = scalar __creghdfe_standardize = ("" == "")
  - scalar __creghdfe_vce_type = `vcetype'
  = scalar __creghdfe_vce_type = 0
  - scalar __creghdfe_compute_dof = 1
  - scalar __creghdfe_df_a_nested = 0
  - scalar __creghdfe_compute_resid = `compute_resid'
  = scalar __creghdfe_compute_resid = 0
  - scalar __creghdfe_has_weights = (`weight_type' > 0)
  = scalar __creghdfe_has_weights = (0 > 0)
  - scalar __creghdfe_weight_type = `weight_type'
  = scalar __creghdfe_weight_type = 0
  - if "`verbose'" != "" {
  = if "" != "" {
    di as text ""
    di as text "{hline 60}"
    di as text "creghdfe: C-Accelerated HDFE Regression"
    di as text "{hline 60}"
    di as text "Depvar:     " as result "`depvar'"
    di as text "Indepvars:  " as result "`indepvars'"
    di as text "Absorb:     " as result "`absorb'"
    di as text "Obs:        " as result `nobs'
    di as text "VCE type:   " as result cond(`vcetype'==0, "unadjusted", cond(`
> vcetype'==1, "robust", "cluster(`clustervar')"))
    if `weight_type' > 0 {
    local wtype_str = cond(`weight_type'==1, "aweight", cond(`weight_type'==2, 
> "fweight", "pweight"))
    di as text "Weights:    " as result "[`wtype_str'=`weight_var']"
    }
    di as text "{hline 60}"
    di ""
    }
  - timer clear 99
  - timer on 99
  - local plugin_varlist `varlist' `absorb'
  = local plugin_varlist y x id
  - if `vcetype' == 2 {
  = if 0 == 2 {
    local plugin_varlist `plugin_varlist' `clustervar'
    }
  - if `weight_type' > 0 {
  = if 0 > 0 {
    local plugin_varlist `plugin_varlist' `weight_var'
    }
  - if `compute_resid' {
  = if 0 {
    local resid_var_pos = `nvars' + `nfe' + (`vcetype' == 2) + (`weight_type' >
>  0) + 1
    local plugin_varlist `plugin_varlist' `resid_varname'
    scalar __creghdfe_resid_var_idx = `resid_var_pos'
    }
  - else {
  - scalar __creghdfe_resid_var_idx = 0
  - }
  - local K_x = `nvars' - 1
  = local K_x = 2 - 1
  - matrix __creghdfe_V = J(`K_x' + 1, `K_x' + 1, 0)
  = matrix __creghdfe_V = J(1 + 1, 1 + 1, 0)
  - capture noisily plugin call ctools_plugin `plugin_varlist' if `touse', "cre
> ghdfe full_regression"
  = capture noisily plugin call ctools_plugin y x id if __000000, "creghdfe ful
> l_regression"
  - local reg_rc = _rc
  - if `reg_rc' {
  = if 0 {
    capture scalar drop __creghdfe_K __creghdfe_G __creghdfe_drop_singletons
    capture scalar drop __creghdfe_verbose __creghdfe_maxiter __creghdfe_tolera
> nce
    capture scalar drop __creghdfe_standardize __creghdfe_vce_type __creghdfe_c
> ompute_dof
    capture scalar drop __creghdfe_df_a_nested __creghdfe_compute_resid
    capture scalar drop __creghdfe_resid_var_idx
    capture scalar drop __creghdfe_has_weights __creghdfe_weight_type
    capture matrix drop __creghdfe_V
    di as error "Error in regression (rc=`reg_rc')"
    exit `reg_rc'
    }
  - timer off 99
  - quietly timer list 99
  - local elapsed = r(t99)
  - local N_final = __creghdfe_N
__creghdfe_N not found
  ------------------------------------------------------------ end creghdfe ---

. set trace off

. di "Return code: `=_rc'"
Return code: 111

. 
end of do-file


  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user 16-core network, expiring  2 Jul 2026
Serial number: 501909320077
  Licensed to: Michael Droste
               Stanford University GSB

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running /Users/Mike/Documents/Stata/profile.do ...

. do /tmp/test_debug_level.do 

. clear all

. set more off

. adopath + "/Users/Mike/Documents/GitHub/stata-ctools/build"
  [1]  (BASE)      "/Applications/Stata/ado/base/"
  [2]  (SITE)      "/Applications/Stata/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/Mike/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/Mike/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/Mike/Documents/GitHub/stata-ctools/build"

. 
. set seed 12345

. set obs 500
Number of observations (_N) was 0, now 500.

. gen firm = ceil(_n/10)

. gen z1 = rnormal()

. gen z2 = rnormal()

. gen x = rnormal()

. gen u = rnormal()

. gen endog_x = 0.5*z1 + 0.3*z2 + 0.2*u

. gen y = 1 + 2*endog_x + 1.5*x + 0.5*u + rnormal()

. 
. di "Testing with verbose to debug..."
Testing with verbose to debug...

. set trace on

. set tracedepth 2

. civreghdfe y (endog_x = z1 z2) x, absorb(firm) level(90) verbose
  -------------------------------------------------------- begin civreghdfe ---
  - version 14.0
  - syntax anything(name=0 equalok) [if] [in] [aw fw pw/], Absorb(varlist) [vce
> (string) TOLerance(real 1e-8) MAXiter(integer 500) Verbose TIMEit FIRST RF SM
> ALL LIML FULLER(real 0) Kclass(real 0) GMM2s CUE COVIV BW(integer 0) KERNEL(s
> tring) DKRAAY(integer 0) RESiduals(name) NOConstant Level(cilevel) noHEADer n
> oFOOTer noOUTput TItle(string) DEPname(string) noid]
  - if "`timeit'" != "" {
  = if "" != "" {
    local t0 = clock("", "hms")
    }
  - local 0 `"`0'"'
  = local 0 `"y (endog_x = z1 z2) x"'
  - gettoken depvar rest : 0, parse("(")
  - local depvar = strtrim("`depvar'")
  = local depvar = strtrim("y ")
  - if strpos("`rest'", "(") == 0 {
  = if strpos("(endog_x = z1 z2) x", "(") == 0 {
    di as error "civreghdfe requires (endogvars = instruments) specification"
    exit 198
    }
  - local rest = strtrim("`rest'")
  = local rest = strtrim("(endog_x = z1 z2) x")
  - if substr("`rest'", 1, 1) == "(" {
  = if substr("(endog_x = z1 z2) x", 1, 1) == "(" {
  - local rest = substr("`rest'", 2, .)
  = local rest = substr("(endog_x = z1 z2) x", 2, .)
  - }
  - local paren_end = strpos("`rest'", ")")
  = local paren_end = strpos("endog_x = z1 z2) x", ")")
  - if `paren_end' == 0 {
  = if 16 == 0 {
    di as error "Unmatched parenthesis in variable specification"
    exit 198
    }
  - local paren_content = substr("`rest'", 1, `paren_end' - 1)
  = local paren_content = substr("endog_x = z1 z2) x", 1, 16 - 1)
  - local exogvars = strtrim(substr("`rest'", `paren_end' + 1, .))
  = local exogvars = strtrim(substr("endog_x = z1 z2) x", 16 + 1, .))
  - local eq_pos = strpos("`paren_content'", "=")
  = local eq_pos = strpos("endog_x = z1 z2", "=")
  - if `eq_pos' == 0 {
  = if 9 == 0 {
    di as error "Must specify instruments after '=' in parentheses"
    exit 198
    }
  - local endogvars = strtrim(substr("`paren_content'", 1, `eq_pos' - 1))
  = local endogvars = strtrim(substr("endog_x = z1 z2", 1, 9 - 1))
  - local instruments = strtrim(substr("`paren_content'", `eq_pos' + 1, .))
  = local instruments = strtrim(substr("endog_x = z1 z2", 9 + 1, .))
  - foreach v of local depvar {
  - confirm numeric variable `v'
  = confirm numeric variable y
  - }
  - foreach v of local endogvars {
  - confirm numeric variable `v'
  = confirm numeric variable endog_x
  - }
  - foreach v of local instruments {
  - confirm numeric variable `v'
  = confirm numeric variable z1
  - }
  - confirm numeric variable `v'
  = confirm numeric variable z2
  - }
  - foreach v of local exogvars {
  - confirm numeric variable `v'
  = confirm numeric variable x
  - }
  - foreach v of local absorb {
  - confirm variable `v'
  = confirm variable firm
  - }
  - capture program list ctools_plugin
  - if _rc != 0 {
  - local __os = c(os)
  - local __machine = c(machine_type)
  - local __is_mac = 0
  - if "`__os'" == "MacOSX" {
  = if "Unix" == "MacOSX" {
    local __is_mac = 1
    }
  - else if strpos(lower("`__machine'"), "mac") > 0 {
  = else if strpos(lower("Mac (Apple Silicon)"), "mac") > 0 {
  - local __is_mac = 1
  - }
  - local __plugin = ""
  - if "`__os'" == "Windows" {
  = if "Unix" == "Windows" {
    local __plugin "ctools_windows.plugin"
    }
  - else if `__is_mac' {
  = else if 1 {
  - local __is_arm = 0
  - if strpos(lower("`__machine'"), "apple") > 0 | strpos(lower("`__machine'"),
>  "arm") > 0 | strpos(lower("`__machine'"), "silicon") > 0 {
  = if strpos(lower("Mac (Apple Silicon)"), "apple") > 0 | strpos(lower("Mac (A
> pple Silicon)"), "arm") > 0 | strpos(lower("Mac (Apple Silicon)"), "silicon")
>  > 0 {
  - local __is_arm = 1
  - }
  - if `__is_arm' == 0 {
  = if 1 == 0 {
    tempfile __archfile
    quietly shell uname -m > "`__archfile'" 2>&1
    tempname __fh
    file open `__fh' using "`__archfile'", read text
    file read `__fh' __archline
    file close `__fh'
    capture erase "`__archfile'"
    if strpos("`__archline'", "arm64") > 0 {
    local __is_arm = 1
    }
    }
  - if `__is_arm' {
  = if 1 {
  - local __plugin "ctools_mac_arm.plugin"
  - }
  - else {
    local __plugin "ctools_mac_x86.plugin"
    }
  - }
  - else if "`__os'" == "Unix" {
  = else if "Unix" == "Unix" {
    local __plugin "ctools_linux.plugin"
    }
  - else {
    local __plugin "ctools.plugin"
    }
  - capture program ctools_plugin, plugin using("`__plugin'")
  = capture program ctools_plugin, plugin using("ctools_mac_arm.plugin")
  - if _rc != 0 & _rc != 110 & "`__plugin'" != "ctools.plugin" {
  = if _rc != 0 & _rc != 110 & "ctools_mac_arm.plugin" != "ctools.plugin" {
    capture program ctools_plugin, plugin using("ctools.plugin")
    }
  - if _rc != 0 & _rc != 110 {
    di as error "civreghdfe: Could not load ctools plugin"
    exit 601
    }
  - }
  - local K_endog : word count `endogvars'
  = local K_endog : word count endog_x
  - local K_exog : word count `exogvars'
  = local K_exog : word count x
  - local K_inst_excl : word count `instruments'
  = local K_inst_excl : word count z1 z2
  - local G : word count `absorb'
  = local G : word count firm
  - local all_instruments `exogvars' `instruments'
  = local all_instruments x z1 z2
  - local K_iv : word count `all_instruments'
  = local K_iv : word count x z1 z2
  - if `K_iv' < `K_endog' + `K_exog' {
  = if 3 < 1 + 1 {
    di as error "Model is underidentified"
    di as error "  Endogenous variables: `K_endog'"
    di as error "  Exogenous variables: `K_exog'"
    di as error "  Total instruments: `K_iv'"
    exit 481
    }
  - local vce_type = 0
  - local cluster_var ""
  - if `"`vce'"' != "" {
  = if `""' != "" {
    local vce_lower = lower(`"`vce'"')
    if `"`vce_lower'"' == "robust" | `"`vce_lower'"' == "r" {
    local vce_type = 1
    }
    else if substr(`"`vce_lower'"', 1, 2) == "cl" {
    local vce_type = 2
    local cluster_spec `"`vce'"'
    gettoken vce_cmd cluster_var : cluster_spec, parse(" (")
    local cluster_var = strtrim(subinstr("`cluster_var'", "(", "", .))
    local cluster_var = strtrim(subinstr("`cluster_var'", ")", "", .))
    confirm variable `cluster_var'
    }
    else if `"`vce_lower'"' == "unadjusted" | `"`vce_lower'"' == "ols" {
    local vce_type = 0
    }
    else {
    di as error "vce(`vce') not supported. Use vce(robust) or vce(cluster varna
> me)"
    exit 198
    }
    }
  - local has_weights = 0
  - local weight_type = 0
  - local weight_var ""
  - if "`weight'" != "" {
  = if "" != "" {
    local has_weights = 1
    if "`weight'" == "aweight" local weight_type = 1
    else if "`weight'" == "fweight" local weight_type = 2
    else if "`weight'" == "pweight" local weight_type = 3
    else {
    di as error "Weight type `weight' not supported"
    exit 198
    }
    local weight_var `"`exp'"'
    confirm numeric variable `weight_var'
    }
  - marksample touse
  - markout `touse' `depvar' `endogvars' `exogvars' `instruments' `absorb'
  = markout __000001 y endog_x x z1 z2 firm
  - if "`cluster_var'" != "" {
  = if "" != "" {
    markout `touse' `cluster_var'
    }
  - if `has_weights' {
  = if 0 {
    markout `touse' `weight_var'
    }
  - qui count if `touse'
  = qui count if __000001
  - local N = r(N)
  - if `N' == 0 {
  = if 500 == 0 {
    di as error "No observations"
    exit 2000
    }
  - if "`verbose'" != "" {
  = if "verbose" != "" {
  - di as text ""

  - di as text "{hline 60}"
------------------------------------------------------------
  - di as text "civreghdfe: C-Accelerated IV Regression with HDFE"
civreghdfe: C-Accelerated IV Regression with HDFE
  - di as text "{hline 60}"
------------------------------------------------------------
  - di as text "Dependent variable:    `depvar'"
  = di as text "Dependent variable:    y"
Dependent variable:    y
  - di as text "Endogenous variables:  `endogvars' (`K_endog')"
  = di as text "Endogenous variables:  endog_x (1)"
Endogenous variables:  endog_x (1)
  - di as text "Exogenous variables:   `exogvars' (`K_exog')"
  = di as text "Exogenous variables:   x (1)"
Exogenous variables:   x (1)
  - di as text "Excluded instruments:  `instruments' (`K_inst_excl')"
  = di as text "Excluded instruments:  z1 z2 (2)"
Excluded instruments:  z1 z2 (2)
  - di as text "Absorbed FE:           `absorb' (`G')"
  = di as text "Absorbed FE:           firm (1)"
Absorbed FE:           firm (1)
  - di as text "Observations:          `N'"
  = di as text "Observations:          500"
Observations:          500
  - if `vce_type' == 1 {
  = if 0 == 1 {
    di as text "VCE:                   Robust"
    }
  - else if `vce_type' == 2 {
  = else if 0 == 2 {
    di as text "VCE:                   Cluster (`cluster_var')"
    }
  - else {
  - di as text "VCE:                   Unadjusted"
VCE:                   Unadjusted
  - }
  - di as text "{hline 60}"
------------------------------------------------------------
  - }
  - local nested_fe_index = 0
  - if `vce_type' == 2 & "`cluster_var'" != "" {
  = if 0 == 2 & "" != "" {
    local fe_idx = 1
    foreach fe_var of local absorb {
    if "`fe_var'" == "`cluster_var'" {
    local nested_fe_index = `fe_idx'
    }
    local fe_idx = `fe_idx' + 1
    }
    }
  - local est_method = 0
  - local kclass_val = 0
  - local fuller_val = 0
  - if "`liml'" != "" {
  = if "" != "" {
    local est_method = 1
    if "`verbose'" != "" {
    di as text "Estimation method:     LIML"
    }
    }
  - else if `fuller' != 0 {
  = else if 0 != 0 {
    local est_method = 2
    local fuller_val = `fuller'
    if "`verbose'" != "" {
    di as text "Estimation method:     Fuller LIML (alpha=`fuller')"
    }
    }
  - else if `kclass' != 0 {
  = else if 0 != 0 {
    local est_method = 3
    local kclass_val = `kclass'
    if "`verbose'" != "" {
    di as text "Estimation method:     k-class (k=`kclass')"
    }
    }
  - else if "`gmm2s'" != "" {
  = else if "" != "" {
    local est_method = 4
    if "`verbose'" != "" {
    di as text "Estimation method:     Two-step GMM"
    }
    }
  - else if "`cue'" != "" {
  = else if "" != "" {
    local est_method = 5
    if "`verbose'" != "" {
    di as text "Estimation method:     CUE (Continuously Updated GMM)"
    }
    }
  - else {
  - if "`verbose'" != "" {
  = if "verbose" != "" {
  - di as text "Estimation method:     2SLS"
Estimation method:     2SLS
  - }
  - }
  - scalar __civreghdfe_K_endog = `K_endog'
  = scalar __civreghdfe_K_endog = 1
  - scalar __civreghdfe_K_exog = `K_exog'
  = scalar __civreghdfe_K_exog = 1
  - scalar __civreghdfe_K_iv = `K_iv'
  = scalar __civreghdfe_K_iv = 3
  - scalar __civreghdfe_G = `G'
  = scalar __civreghdfe_G = 1
  - scalar __civreghdfe_has_cluster = (`vce_type' == 2)
  = scalar __civreghdfe_has_cluster = (0 == 2)
  - scalar __civreghdfe_has_weights = `has_weights'
  = scalar __civreghdfe_has_weights = 0
  - scalar __civreghdfe_weight_type = `weight_type'
  = scalar __civreghdfe_weight_type = 0
  - scalar __civreghdfe_vce_type = `vce_type'
  = scalar __civreghdfe_vce_type = 0
  - scalar __civreghdfe_maxiter = `maxiter'
  = scalar __civreghdfe_maxiter = 500
  - scalar __civreghdfe_tolerance = `tolerance'
  = scalar __civreghdfe_tolerance = 1.00000000000e-08
  - scalar __civreghdfe_verbose = ("`verbose'" != "")
  = scalar __civreghdfe_verbose = ("verbose" != "")
  - scalar __civreghdfe_nested_fe_index = `nested_fe_index'
  = scalar __civreghdfe_nested_fe_index = 0
  - scalar __civreghdfe_est_method = `est_method'
  = scalar __civreghdfe_est_method = 0
  - scalar __civreghdfe_kclass = `kclass_val'
  = scalar __civreghdfe_kclass = 0
  - scalar __civreghdfe_fuller = `fuller_val'
  = scalar __civreghdfe_fuller = 0
  - scalar __civreghdfe_coviv = ("`coviv'" != "")
  = scalar __civreghdfe_coviv = ("" != "")
  - local kernel_type = 0
  - local bw_val = `bw'
  = local bw_val = 0
  - local dkraay_val = `dkraay'
  = local dkraay_val = 0
  - if "`kernel'" != "" {
  = if "" != "" {
    local kernel_lower = lower("`kernel'")
    if "`kernel_lower'" == "bartlett" | "`kernel_lower'" == "nwest" {
    local kernel_type = 1
    }
    else if "`kernel_lower'" == "parzen" {
    local kernel_type = 2
    }
    else if "`kernel_lower'" == "quadraticspectral" | "`kernel_lower'" == "qs" 
> {
    local kernel_type = 3
    }
    else if "`kernel_lower'" == "truncated" | "`kernel_lower'" == "trunc" {
    local kernel_type = 4
    }
    else if "`kernel_lower'" == "tukey" | "`kernel_lower'" == "thann" {
    local kernel_type = 5
    }
    else {
    di as error "Unknown kernel type: `kernel'"
    di as error "Valid options: bartlett, parzen, quadraticspectral, truncated,
>  tukey"
    exit 198
    }
    }
  - if `dkraay_val' > 0 & `kernel_type' == 0 {
  = if 0 > 0 & 0 == 0 {
    local kernel_type = 1
    }
  - if `kernel_type' > 0 & `bw_val' == 0 {
  = if 0 > 0 & 0 == 0 {
    local bw_val = floor(4 * (`N'/100)^(2/9))
    if `bw_val' < 1 local bw_val = 1
    }
  - scalar __civreghdfe_kernel = `kernel_type'
  = scalar __civreghdfe_kernel = 0
  - scalar __civreghdfe_bw = `bw_val'
  = scalar __civreghdfe_bw = 0
  - scalar __civreghdfe_dkraay = `dkraay_val'
  = scalar __civreghdfe_dkraay = 0
  - if "`verbose'" != "" & `kernel_type' > 0 {
  = if "verbose" != "" & 0 > 0 {
    di as text "HAC: kernel=`kernel_type', bandwidth=`bw_val'"
    if `dkraay_val' > 0 {
    di as text "Driscoll-Kraay standard errors with lag `dkraay_val'"
    }
    }
  - local K_total = `K_endog' + `K_exog'
  = local K_total = 1 + 1
  - tempname b_temp V_temp
  - matrix `b_temp' = J(1, `K_total', 0)
  = matrix __000002 = J(1, 2, 0)
  - matrix `V_temp' = J(`K_total', `K_total', 0)
  = matrix __000003 = J(2, 2, 0)
  - matrix __civreghdfe_b = `b_temp'
  = matrix __civreghdfe_b = __000002
  - matrix __civreghdfe_V = `V_temp'
  = matrix __civreghdfe_V = __000003
  - local plugin_vars `depvar' `endogvars' `exogvars' `all_instruments' `absorb
> '
  = local plugin_vars y endog_x x x z1 z2 firm
  - if `vce_type' == 2 {
  = if 0 == 2 {
    local plugin_vars `plugin_vars' `cluster_var'
    }
  - if `has_weights' {
  = if 0 {
    local plugin_vars `plugin_vars' `weight_var'
    }
  - plugin call ctools_plugin `plugin_vars' if `touse', "civreghdfe iv_regressi
> on"
  = plugin call ctools_plugin y endog_x x x z1 z2 firm if __000001, "civreghdfe
>  iv_regression"
civreghdfe: N=500, K_endog=1, K_exog=1, K_iv=3, G=1
civreghdfe: 500 valid observations (dropped 0)
civreghdfe: No singletons found
civreghdfe: Partialling out fixed effects...
civreghdfe: Fixed effects partialled out
civreghdfe: Computing 2SLS estimation
  N=500, K_exog=1, K_endog=1, K_iv=3
  beta[0] = 1.48418
  beta[1] = 2.0905
  First-stage F[0] = 2104.19 (R^2 = 0.903982)
civreghdfe: Done
  - local N_used = __civreghdfe_N
  - local df_r = __civreghdfe_df_r
  - local df_a = __civreghdfe_df_a
  - local K = __civreghdfe_K
  - local rss = __civreghdfe_rss
  - local tss = __civreghdfe_tss
  - local r2 = __civreghdfe_r2
  - local rmse = __civreghdfe_rmse
  - local F_model = __civreghdfe_F
  - forval g = 1/`G' {
  = forval g = 1/1 {
  - capture local fe_levels_`g' = __civreghdfe_num_levels_`g'
  = capture local fe_levels_1 = __civreghdfe_num_levels_1
  - if _rc != 0 local fe_levels_`g' = .
  = if _rc != 0 local fe_levels_1 = .
  - local fe_nested_`g' = 0
  = local fe_nested_1 = 0
  - }
  - if `vce_type' == 2 & "`cluster_var'" != "" {
  = if 0 == 2 & "" != "" {
    forval g = 1/`G' {
    local fevar : word `g' of `absorb'
    if "`fevar'" == "`cluster_var'" {
    local fe_nested_`g' = 1
    }
    else {
    tempvar fe_clust_check
    qui bysort `fevar' (`cluster_var'): gen byte `fe_clust_check' = (`cluster_v
> ar'[1] != `cluster_var'[_N]) if `touse'
    qui summ `fe_clust_check' if `touse', meanonly
    if r(max) == 0 {
    local fe_nested_`g' = 1
    }
    drop `fe_clust_check'
    }
    }
    }
  - if `vce_type' == 2 {
  = if 0 == 2 {
    local N_clust = __civreghdfe_N_clust
    }
  - matrix `b_temp' = __civreghdfe_b
  = matrix __000002 = __civreghdfe_b
  - matrix `V_temp' = __civreghdfe_V
  = matrix __000003 = __civreghdfe_V
  - local varnames_c ""
  - foreach v of local exogvars {
  - local varnames_c `varnames_c' `v'
  = local varnames_c  x
  - }
  - foreach v of local endogvars {
  - local varnames_c `varnames_c' `v'
  = local varnames_c x endog_x
  - }
  - local varnames ""
  - foreach v of local endogvars {
  - local varnames `varnames' `v'
  = local varnames  endog_x
  - }
  - foreach v of local exogvars {
  - local varnames `varnames' `v'
  = local varnames endog_x x
  - }
  - local K_total = `K_exog' + `K_endog'
  = local K_total = 1 + 1
  - if `K_endog' > 0 & `K_exog' > 0 {
  = if 1 > 0 & 1 > 0 {
  - tempname b_reorder V_reorder
  - matrix `b_reorder' = J(1, `K_total', 0)
  = matrix __000004 = J(1, 2, 0)
  - matrix `V_reorder' = J(`K_total', `K_total', 0)
  = matrix __000005 = J(2, 2, 0)
  - forvalues e = 1/`K_endog' {
  = forvalues e = 1/1 {
  - local c_idx = `K_exog' + `e'
  = local c_idx = 1 + 1
  - matrix `b_reorder'[1, `e'] = `b_temp'[1, `c_idx']
  = matrix __000004[1, 1] = __000002[1, 2]
  - }
  - forvalues x = 1/`K_exog' {
  = forvalues x = 1/1 {
  - local new_idx = `K_endog' + `x'
  = local new_idx = 1 + 1
  - matrix `b_reorder'[1, `new_idx'] = `b_temp'[1, `x']
  = matrix __000004[1, 2] = __000002[1, 1]
  - }
  - forvalues i = 1/`K_total' {
  = forvalues i = 1/2 {
  - if `i' <= `K_endog' {
  = if 1 <= 1 {
  - local old_i = `K_exog' + `i'
  = local old_i = 1 + 1
  - }
  - else {
    local old_i = `i' - `K_endog'
    }
  - forvalues j = 1/`K_total' {
  = forvalues j = 1/2 {
  - if `j' <= `K_endog' {
  = if 1 <= 1 {
  - local old_j = `K_exog' + `j'
  = local old_j = 1 + 1
  - }
  - else {
    local old_j = `j' - `K_endog'
    }
  - matrix `V_reorder'[`i', `j'] = `V_temp'[`old_i', `old_j']
  = matrix __000005[1, 1] = __000003[2, 2]
  - }
  - if `j' <= `K_endog' {
  = if 2 <= 1 {
    local old_j = `K_exog' + `j'
    }
  - else {
  - local old_j = `j' - `K_endog'
  = local old_j = 2 - 1
  - }
  - matrix `V_reorder'[`i', `j'] = `V_temp'[`old_i', `old_j']
  = matrix __000005[1, 2] = __000003[2, 1]
  - }
  - }
  - if `i' <= `K_endog' {
  = if 2 <= 1 {
    local old_i = `K_exog' + `i'
    }
  - else {
  - local old_i = `i' - `K_endog'
  = local old_i = 2 - 1
  - }
  - forvalues j = 1/`K_total' {
  = forvalues j = 1/2 {
  - if `j' <= `K_endog' {
  = if 1 <= 1 {
  - local old_j = `K_exog' + `j'
  = local old_j = 1 + 1
  - }
  - else {
    local old_j = `j' - `K_endog'
    }
  - matrix `V_reorder'[`i', `j'] = `V_temp'[`old_i', `old_j']
  = matrix __000005[2, 1] = __000003[1, 2]
  - }
  - if `j' <= `K_endog' {
  = if 2 <= 1 {
    local old_j = `K_exog' + `j'
    }
  - else {
  - local old_j = `j' - `K_endog'
  = local old_j = 2 - 1
  - }
  - matrix `V_reorder'[`i', `j'] = `V_temp'[`old_i', `old_j']
  = matrix __000005[2, 2] = __000003[1, 1]
  - }
  - }
  - matrix `b_temp' = `b_reorder'
  = matrix __000002 = __000004
  - matrix `V_temp' = `V_reorder'
  = matrix __000003 = __000005
  - }
  - matrix colnames `b_temp' = `varnames'
  = matrix colnames __000002 = endog_x x
  - matrix rownames `b_temp' = `depvar'
  = matrix rownames __000002 = y
  - matrix colnames `V_temp' = `varnames'
  = matrix colnames __000003 = endog_x x
  - matrix rownames `V_temp' = `varnames'
  = matrix rownames __000003 = endog_x x
  - tempname Vinv b_col wald_temp wald_stat
  - matrix `Vinv' = syminv(`V_temp')
  = matrix __000006 = syminv(__000003)
  - matrix `b_col' = `b_temp''
  = matrix __000007 = __000002'
  - matrix `wald_temp' = `Vinv' * `b_col'
  = matrix __000008 = __000006 * __000007
  - matrix `wald_stat' = `b_temp' * `wald_temp'
  = matrix __000009 = __000002 * __000008
  - local F_wald = `wald_stat'[1,1] / `K_total'
  = local F_wald = __000009[1,1] / 2
  - ereturn clear
  - local depname_use = cond("`depname'" != "", "`depname'", "`depvar'")
  = local depname_use = cond("" != "", "", "y")
  - ereturn post `b_temp' `V_temp', esample(`touse') depname(`depname_use')
  = ereturn post __000002 __000003, esample(__000001) depname(y)
  - ereturn scalar N = `N_used'
  = ereturn scalar N = 500
  - ereturn scalar df_r = `df_r'
  = ereturn scalar df_r = 448
  - ereturn scalar df_a = `df_a'
  = ereturn scalar df_a = 50
  - ereturn scalar K = `K'
  = ereturn scalar K = 2
  - ereturn scalar level = `level'
  = ereturn scalar level = 90
  - ereturn scalar K_endog = `K_endog'
  = ereturn scalar K_endog = 1
  - ereturn scalar K_exog = `K_exog'
  = ereturn scalar K_exog = 1
  - ereturn scalar K_iv = `K_iv'
  = ereturn scalar K_iv = 3
  - ereturn scalar G = `G'
  = ereturn scalar G = 1
  - if `vce_type' == 2 {
  = if 0 == 2 {
    ereturn scalar N_clust = `N_clust'
    }
  - forvalues e = 1/`K_endog' {
  = forvalues e = 1/1 {
  - capture scalar temp_F = __civreghdfe_F1_`e'
  = capture scalar temp_F = __civreghdfe_F1_1
  - if _rc == 0 {
  - ereturn scalar F_first`e' = temp_F
  = ereturn scalar F_first1 = temp_F
  - }
  - }
  - ereturn local cmd "civreghdfe"
  - ereturn local cmdline `"civreghdfe `0'"'
  = ereturn local cmdline `"civreghdfe y (endog_x = z1 z2) x"'
  - ereturn local depvar "`depvar'"
  = ereturn local depvar "y"
  - ereturn local endogvars "`endogvars'"
  = ereturn local endogvars "endog_x"
  - ereturn local exogvars "`exogvars'"
  = ereturn local exogvars "x"
  - ereturn local instruments "`instruments'"
  = ereturn local instruments "z1 z2"
  - ereturn local absorb "`absorb'"
  = ereturn local absorb "firm"
  - if `est_method' == 1 {
  = if 0 == 1 {
    ereturn local title "LIML regression with HDFE"
    ereturn local model "liml"
    capture ereturn scalar lambda = __civreghdfe_lambda
    }
  - else if `est_method' == 2 {
  = else if 0 == 2 {
    ereturn local title "Fuller LIML regression with HDFE"
    ereturn local model "fuller"
    ereturn scalar fuller = `fuller_val'
    capture ereturn scalar lambda = __civreghdfe_lambda
    }
  - else if `est_method' == 3 {
  = else if 0 == 3 {
    ereturn local title "k-class regression with HDFE"
    ereturn local model "kclass"
    ereturn scalar kclass = `kclass_val'
    }
  - else if `est_method' == 4 {
  = else if 0 == 4 {
    ereturn local title "2-step GMM with HDFE"
    ereturn local model "gmm2s"
    }
  - else if `est_method' == 5 {
  = else if 0 == 5 {
    ereturn local title "CUE regression with HDFE"
    ereturn local model "cue"
    }
  - else {
  - ereturn local title "IV (2SLS) regression with HDFE"
  - ereturn local model "2sls"
  - }
  - if `vce_type' == 1 {
  = if 0 == 1 {
    ereturn local vcetype "Robust"
    }
  - else if `vce_type' == 2 {
  = else if 0 == 2 {
    ereturn local vcetype "Cluster"
    ereturn local clustvar "`cluster_var'"
    }
  - ereturn scalar rss = `rss'
  = ereturn scalar rss = 520.1053911974843
  - ereturn scalar tss = `tss'
  = ereturn scalar tss = 2308.945364994116
  - ereturn scalar r2 = `r2'
  = ereturn scalar r2 = .7747433096153794
  - ereturn scalar rmse = `rmse'
  = ereturn scalar rmse = 1.077473681313356
  - ereturn scalar F = `F_wald'
  = ereturn scalar F = 669.9253386913067
  - if "`header'" == "" {
  = if "" == "" {
  - di as text ""

  - if "`title'" != "" {
  = if "" != "" {
    di as text "`title'"
    }
  - else {
  - di as text "IV (2SLS) estimation"
IV (2SLS) estimation
  - }
  - di as text "{hline 20}"
--------------------
  - di as text ""

  - if `vce_type' == 0 {
  = if 0 == 0 {
  - di as text "Estimates efficient for homoskedasticity only"
Estimates efficient for homoskedasticity only
  - di as text "Statistics consistent for homoskedasticity only"
Statistics consistent for homoskedasticity only
  - }
  - else if `vce_type' == 1 {
  = else if 0 == 1 {
    di as text "Estimates efficient for homoskedasticity only"
    di as text "Statistics robust to heteroskedasticity"
    }
  - else if `vce_type' == 2 {
  = else if 0 == 2 {
    di as text "Estimates efficient for homoskedasticity only"
    di as text "Statistics robust to heteroskedasticity and clustering on `clus
> ter_var'"
    }
  - di as text ""

  - if `vce_type' == 2 {
  = if 0 == 2 {
    di as text "Number of clusters (`cluster_var') = " as result %9.0fc `N_clus
> t' as text _col(55) "Number of obs =" as result %9.0fc `N_used'
    }
  - else {
  - di as text _col(55) "Number of obs =" as result %9.0fc `N_used'
  = di as text _col(55) "Number of obs =" as result %9.0fc 500
                                                      Number of obs =      500
  - }
  - local prob_F = Ftail(`K_total', `df_r', `F_wald')
  = local prob_F = Ftail(2, 448, 669.9253386913067)
  - if `vce_type' == 2 {
  = if 0 == 2 {
    di as text _col(55) "F(" %3.0f `K_total' "," %6.0f (`N_clust' - 1) ") =" as
>  result %9.2f `F_wald'
    }
  - else {
  - di as text _col(55) "F(" %3.0f `K_total' "," %6.0f `df_r' ") =" as result %
> 9.2f `F_wald'
  = di as text _col(55) "F(" %3.0f 2 "," %6.0f 448 ") =" as result %9.2f 669.92
> 53386913067
                                                      F(  2,   448) =   669.93
  - }
  - di as text _col(55) "Prob > F      =" as result %9.4f `prob_F'
  = di as text _col(55) "Prob > F      =" as result %9.4f 2.3124727259e-135
                                                      Prob > F      =   0.0000
  - di as text "Total (centered) SS     =  " as result %-14.1f `tss' as text _c
> ol(55) "Centered R2   =" as result %9.4f `r2'
  = di as text "Total (centered) SS     =  " as result %-14.1f 2308.94536499411
> 6 as text _col(55) "Centered R2   =" as result %9.4f .7747433096153794
Total (centered) SS     =  2308.9                     Centered R2   =   0.7747
  - di as text "Total (uncentered) SS   =  " as result %-14.1f `tss' as text _c
> ol(55) "Uncentered R2 =" as result %9.4f `r2'
  = di as text "Total (uncentered) SS   =  " as result %-14.1f 2308.94536499411
> 6 as text _col(55) "Uncentered R2 =" as result %9.4f .7747433096153794
Total (uncentered) SS   =  2308.9                     Uncentered R2 =   0.7747
  - di as text "Residual SS             =  " as result %-14.1f `rss' as text _c
> ol(55) "Root MSE      =" as result %9.0f round(`rmse')
  = di as text "Residual SS             =  " as result %-14.1f 520.105391197484
> 3 as text _col(55) "Root MSE      =" as result %9.0f round(1.077473681313356)
Residual SS             =  520.1                      Root MSE      =        1
  - di as text ""

  - }
  - if "`output'" == "" {
  = if "" == "" {
  - ereturn display, level(`level')
  = ereturn display, level(90)
    ------------------------------------------------ begin _ereturn_display ---
    - version 11
    - if "`e(b)'" == "" & "`e(V)'" == "" {
    = if "matrix" == "" & "matrix" == "" {
      exit
      }
    - if "`e(cmd)'" == "regress" {
    = if "civreghdfe" == "regress" {
      local ALTOPT Beta
      }
    - syntax [, eform(passthru) First neq(integer -1) PLus `ALTOPT' *]
    = syntax [, eform(passthru) First neq(integer -1) PLus  *]
    - _get_mcompare, `options'
    = _get_mcompare, level(90)
    - if "`s(method)'" != "" {
    = if "noadjust" != "" {
    - loca mcopt mcompare(`s(method)' `s(adjustall)')
    = loca mcopt mcompare(noadjust )
    - }
    - _get_diopts diopts, `s(options)'
    = _get_diopts diopts, level(90)
    - if !`:length local first' {
    = if !0 {
    - local first showeqns
    - }
    - if `neq' < 1 {
    = if -1 < 1 {
    - _ms_eq_info
    - local neqopt neq(`r(k_eq)')
    = local neqopt neq(1)
    - }
    - else {
      local neqopt neq(`neq')
      }
    - _coef_table, nodiparm nocnsreport noeqcheck eformall `eform' `first' `neq
> opt' `plus' `beta' `mcopt' `diopts'
    = _coef_table, nodiparm nocnsreport noeqcheck eformall  showeqns neq(1)   m
> compare(noadjust ) level(90)
------------------------------------------------------------------------------
           y | Coefficient  Std. err.      t    P>|t|     [90% conf. interval]
-------------+----------------------------------------------------------------
     endog_x |     2.0905   .0852746    24.51   0.000     1.949945    2.231055
           x |   1.484181   .0498034    29.80   0.000     1.402092     1.56627
------------------------------------------------------------------------------
    -------------------------------------------------- end _ereturn_display ---
  - }
  - if "`footer'" == "" {
  = if "" == "" {
  - capture scalar temp_underid = __civreghdfe_underid
  - capture scalar temp_underid_df = __civreghdfe_underid_df
  - if _rc == 0 {
  - local underid_stat = temp_underid
  - local underid_df = temp_underid_df
  - ereturn scalar idstat = `underid_stat'
  = ereturn scalar idstat = 451.9910704902432
  - ereturn scalar iddf = `underid_df'
  = ereturn scalar iddf = 2
  - ereturn scalar idp = chi2tail(`underid_df', `underid_stat')
  = ereturn scalar idp = chi2tail(2, 451.9910704902432)
  - }
  - if "`id'" == "" {
  = if "" == "" {
  - if `vce_type' == 0 {
  = if 0 == 0 {
  - di as text "Underidentification test (Anderson canon. corr. LM statistic):"
>  _col(65) as result %14.3f `underid_stat'
  = di as text "Underidentification test (Anderson canon. corr. LM statistic):"
>  _col(65) as result %14.3f 451.9910704902432
Underidentification test (Anderson canon. corr. LM statistic):         451.991
  - }
  - else {
    di as text "Underidentification test (Kleibergen-Paap rk LM statistic):" _c
> ol(65) as result %14.3f `underid_stat'
    }
  - local underid_p = chi2tail(`underid_df', `underid_stat')
  = local underid_p = chi2tail(2, 451.9910704902432)
  - di as text _col(52) "Chi-sq(" as result `underid_df' as text ") P-val =" as
>  result %10.4f `underid_p'
  = di as text _col(52) "Chi-sq(" as result 2 as text ") P-val =" as result %10
> .4f 7.10208896566e-99
                                                   Chi-sq(2) P-val =    0.0000
  - di as text "{hline 78}"
------------------------------------------------------------------------------
  - }
  - capture scalar temp_cd_f = __civreghdfe_cd_f
  - capture scalar temp_kp_f = __civreghdfe_kp_f
  - local cd_f_val = temp_cd_f
  - local kp_f_val = temp_kp_f
  - di as text "Weak identification test (Cragg-Donald Wald F statistic):" _col
> (65) as result %14.3f `cd_f_val'
  = di as text "Weak identification test (Cragg-Donald Wald F statistic):" _col
> (65) as result %14.3f 2104.191976078934
Weak identification test (Cragg-Donald Wald F statistic):             2104.192
  - if `vce_type' != 0 & `kp_f_val' > 0 {
  = if 0 != 0 & 0 > 0 {
    di as text "                         (Kleibergen-Paap rk Wald F statistic):
> " _col(65) as result %14.3f `kp_f_val'
    }
  - if `K_endog' == 1 {
  = if 1 == 1 {
  - if `K_inst_excl' == 1 {
  = if 2 == 1 {
    di as text "Stock-Yogo weak ID test critical values: 10% maximal IV size" _
> col(65) as result %14.2f 16.38
    di as text "                                         15% maximal IV size" _
> col(65) as result %14.2f 8.96
    di as text "                                         20% maximal IV size" _
> col(65) as result %14.2f 6.66
    di as text "                                         25% maximal IV size" _
> col(65) as result %14.2f 5.53
    }
  - else if `K_inst_excl' == 2 {
  = else if 2 == 2 {
  - di as text "Stock-Yogo weak ID test critical values: 10% maximal IV size" _
> col(65) as result %14.2f 19.93
Stock-Yogo weak ID test critical values: 10% maximal IV size             19.93
  - di as text "                                         15% maximal IV size" _
> col(65) as result %14.2f 11.59
                                         15% maximal IV size             11.59
  - di as text "                                         20% maximal IV size" _
> col(65) as result %14.2f 8.75
                                         20% maximal IV size              8.75
  - di as text "                                         25% maximal IV size" _
> col(65) as result %14.2f 7.25
                                         25% maximal IV size              7.25
  - }
  - else if `K_inst_excl' == 3 {
  = else if 2 == 3 {
    di as text "Stock-Yogo weak ID test critical values: 10% maximal IV size" _
> col(65) as result %14.2f 22.30
    di as text "                                         15% maximal IV size" _
> col(65) as result %14.2f 12.83
    di as text "                                         20% maximal IV size" _
> col(65) as result %14.2f 9.54
    di as text "                                         25% maximal IV size" _
> col(65) as result %14.2f 7.80
    }
  - else {
    di as text "Stock-Yogo weak ID test critical values: 10% maximal IV size" _
> col(65) as result %14.2f 16.38
    di as text "                                         15% maximal IV size" _
> col(65) as result %14.2f 8.96
    di as text "                                         20% maximal IV size" _
> col(65) as result %14.2f 6.66
    di as text "                                         25% maximal IV size" _
> col(65) as result %14.2f 5.53
    }
  - }
  - else if `K_endog' == 2 {
  = else if 1 == 2 {
    if `K_inst_excl' == 3 {
    di as text "Stock-Yogo weak ID test critical values: 10% maximal IV size" _
> col(65) as result %14.2f 13.43
    di as text "                                         15% maximal IV size" _
> col(65) as result %14.2f 8.18
    di as text "                                         20% maximal IV size" _
> col(65) as result %14.2f 6.40
    di as text "                                         25% maximal IV size" _
> col(65) as result %14.2f 5.45
    }
    else {
    di as text "(Stock-Yogo critical values: see Stock-Yogo (2005) for `K_endog
> ' endogenous, `K_inst_excl' instruments)"
    }
    }
  - else {
    di as text "(Stock-Yogo critical values: see Stock-Yogo (2005) for `K_endog
> ' endogenous variables)"
    }
  - di as text "Source: Stock-Yogo (2005).  Reproduced by permission."
Source: Stock-Yogo (2005).  Reproduced by permission.
  - if `vce_type' != 0 {
  = if 0 != 0 {
    di as text "NB: Critical values are for Cragg-Donald F statistic and i.i.d.
>  errors."
    }
  - di as text "{hline 78}"
------------------------------------------------------------------------------
  - if "`rf'" != "" {
  = if "" != "" {
    di as text ""
    di as text "{hline 60}"
    di as text "Reduced-form regression: `depvar' on instruments"
    di as text "{hline 60}"
    tempname iv_b iv_V
    matrix `iv_b' = e(b)
    matrix `iv_V' = e(V)
    local iv_N = e(N)
    local iv_df_r = e(df_r)
    local iv_df_a = e(df_a)
    local iv_K = e(K)
    local iv_K_endog = e(K_endog)
    local iv_K_exog = e(K_exog)
    local iv_K_iv = e(K_iv)
    local iv_G = e(G)
    local iv_title = e(title)
    local iv_model = e(model)
    local iv_vcetype = e(vcetype)
    local iv_cmd = e(cmd)
    local rf_vce = "`vce'"
    if "`rf_vce'" == "" local rf_vce = "unadjusted"
    qui creghdfe `depvar' `exogvars' `instruments' `if' `in' [`weight'`exp'], a
> bsorb(`absorb') vce(`rf_vce')
    tempname rf_b rf_V
    matrix `rf_b' = e(b)
    matrix `rf_V' = e(V)
    local rf_vars : colnames `rf_b'
    local rf_K : word count `rf_vars'
    di as text ""
    di as text "{hline 78}"
    di as text _col(14) "|" _col(28) "`iv_vcetype'"
    di as text %12s abbrev("`depvar'", 12) " | Coefficient  std. err.      t   
>  P>|t|" "     [95% conf. interval]"
    di as text "{hline 13}+{hline 64}"
    forvalues v = 1/`rf_K' {
    local vname : word `v' of `rf_vars'
    local b = `rf_b'[1, `v']
    local se = sqrt(`rf_V'[`v', `v'])
    if `se' > 0 {
    local t = `b' / `se'
    local p = 2 * ttail(`iv_df_r', abs(`t'))
    local ci_lo = `b' - invttail(`iv_df_r', 0.025) * `se'
    local ci_hi = `b' + invttail(`iv_df_r', 0.025) * `se'
    di as text %12s abbrev("`vname'", 12) " |" as result %11.6g `b' "  " %9.6g 
> `se' "  " %7.2f `t' "   " %5.3f `p' "    " %11.6g `ci_lo' "  " %11.6g `ci_hi'
    }
    else {
    di as text %12s abbrev("`vname'", 12) " |" as result %11.6g `b' "  " "(omit
> ted)"
    }
    }
    di as text "{hline 78}"
    }
  - capture scalar temp_sargan = __civreghdfe_sargan
  - capture scalar temp_sargan_df = __civreghdfe_sargan_df
  - capture scalar temp_cd_f = __civreghdfe_cd_f
  - capture scalar temp_endog_chi2 = __civreghdfe_endog_chi2
  - capture scalar temp_endog_f = __civreghdfe_endog_f
  - capture scalar temp_endog_df = __civreghdfe_endog_df
  - if _rc == 0 {
  - local sargan_val = temp_sargan
  - local sargan_df = temp_sargan_df
  - local cd_f_val = temp_cd_f
  - local endog_chi2 = temp_endog_chi2
  - local endog_f = temp_endog_f
  - local endog_df = temp_endog_df
  - ereturn scalar sargan = `sargan_val'
  = ereturn scalar sargan = .0005413500708867
  - ereturn scalar sargan_df = `sargan_df'
  = ereturn scalar sargan_df = 1
  - if `sargan_df' > 0 {
  = if 1 > 0 {
  - ereturn scalar sargan_p = chi2tail(`sargan_df', `sargan_val')
  = ereturn scalar sargan_p = chi2tail(1, .0005413500708867)
  - }
  - ereturn scalar cd_f = `cd_f_val'
  = ereturn scalar cd_f = 2104.191976078934
  - capture scalar temp_kp_f2 = __civreghdfe_kp_f
  - if _rc == 0 & `vce_type' != 0 {
  = if _rc == 0 & 0 != 0 {
    local kp_f_val2 = temp_kp_f2
    if `kp_f_val2' > 0 {
    ereturn scalar widstat = `kp_f_val2'
    ereturn scalar kp_f = `kp_f_val2'
    }
    else {
    ereturn scalar widstat = `cd_f_val'
    }
    }
  - else {
  - ereturn scalar widstat = `cd_f_val'
  = ereturn scalar widstat = 2104.191976078934
  - }
  - capture scalar drop temp_kp_f2
  - ereturn scalar endog_chi2 = `endog_chi2'
  = ereturn scalar endog_chi2 = 85.35257122458653
  - ereturn scalar endog_f = `endog_f'
  = ereturn scalar endog_f = 85.35257122458653
  - ereturn scalar endog_df = `endog_df'
  = ereturn scalar endog_df = 1
  - if `endog_df' > 0 {
  = if 1 > 0 {
  - ereturn scalar endog_p = chi2tail(`endog_df', `endog_chi2')
  = ereturn scalar endog_p = chi2tail(1, 85.35257122458653)
  - }
  - if `vce_type' == 0 {
  = if 0 == 0 {
  - di as text "Sargan statistic (overidentification test of all instruments):"
>  _col(65) as result %14.3f `sargan_val'
  = di as text "Sargan statistic (overidentification test of all instruments):"
>  _col(65) as result %14.3f .0005413500708867
Sargan statistic (overidentification test of all instruments):           0.001
  - }
  - else {
    di as text "Hansen J statistic (overidentification test of all instruments)
> :" _col(65) as result %14.3f `sargan_val'
    }
  - if `sargan_df' > 0 {
  = if 1 > 0 {
  - local sargan_p = chi2tail(`sargan_df', `sargan_val')
  = local sargan_p = chi2tail(1, .0005413500708867)
  - di as text _col(52) "Chi-sq(" as result `sargan_df' as text ") P-val =" as 
> result %10.4f `sargan_p'
  = di as text _col(52) "Chi-sq(" as result 1 as text ") P-val =" as result %10
> .4f .9814373499329541
                                                   Chi-sq(1) P-val =    0.9814
  - }
  - else {
    di as text _col(50) "(equation exactly identified)"
    }
  - di as text "{hline 78}"
------------------------------------------------------------------------------
  - }
  - di as text "Instrumented:         `endogvars'"
  = di as text "Instrumented:         endog_x"
Instrumented:         endog_x
  - if "`exogvars'" != "" {
  = if "x" != "" {
  - di as text "Included instruments: `exogvars'"
  = di as text "Included instruments: x"
Included instruments: x
  - }
  - di as text "Excluded instruments: `instruments'"
  = di as text "Excluded instruments: z1 z2"
Excluded instruments: z1 z2
  - di as text "Partialled-out:       _cons"
Partialled-out:       _cons
  - di as text "                      nb: total SS, model F and R2s are after p
> artialling-out;"
                      nb: total SS, model F and R2s are after partialling-out;
  - di as text "                          any small-sample adjustments include 
> partialled-out"
                          any small-sample adjustments include partialled-out
  - di as text "                          variables in regressor count K"
                          variables in regressor count K
  - di as text "{hline 78}"
------------------------------------------------------------------------------
  - di as text ""

  - di as text "Absorbed degrees of freedom:"
Absorbed degrees of freedom:
  - di as text "{hline 53}+"
-----------------------------------------------------+
  - di as text " Absorbed FE | Categories  - Redundant  = Num. Coefs |"
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
  - di as text "{hline 13}+{hline 39}|"
-------------+---------------------------------------|
  - local total_coefs = 0
  - local has_nested = 0
  - forval g = 1/`G' {
  = forval g = 1/1 {
  - local fevar : word `g' of `absorb'
  = local fevar : word 1 of firm
  - local cats = `fe_levels_`g''
  = local cats = 50
  - if `fe_nested_`g'' == 1 {
  = if 0 == 1 {
    local redundant = `cats'
    local has_nested = 1
    local nested_marker "*"
    }
  - else {
  - if `g' == 1 | (`has_nested' == 0 & `g' == 1) {
  = if 1 == 1 | (0 == 0 & 1 == 1) {
  - local first_nonnested = 1
  - forval prev = 1/`=`g'-1' {
  = forval prev = 1/0 {
    if `fe_nested_`prev'' == 0 {
    local first_nonnested = 0
    }
    }
  - if `first_nonnested' {
  = if 1 {
  - local redundant = 0
  - }
  - else {
    local redundant = 1
    }
  - }
  - else {
    local redundant = 1
    }
  - local nested_marker " "
  - }
  - local coefs = `cats' - `redundant'
  = local coefs = 50 - 0
  - local total_coefs = `total_coefs' + `coefs'
  = local total_coefs = 0 + 50
  - di as text %12s abbrev("`fevar'", 12) " |" as result %10.0f `cats' as text 
> "  " as result %10.0f `redundant' as text "  " as result %10.0f `coefs' as te
> xt "    `nested_marker'|"
  = di as text %12s abbrev("firm", 12) " |" as result %10.0f 50 as text "  " as
>  result %10.0f 0 as text "  " as result %10.0f 50 as text "     |"
        firm |        50           0          50     |
  - }
  - di as text "{hline 53}+"
-----------------------------------------------------+
  - if `has_nested' {
  = if 0 {
    di as text "* = FE nested within cluster; treated as redundant for DoF comp
> utation"
    }
  - di as text ""

  - }
  - if "`timeit'" != "" {
  = if "" != "" {
    local t1 = clock("", "hms")
    local elapsed = (`t1' - `t0') / 1000
    di as text ""
    di as text "Total time: " as result %6.3f `elapsed' " seconds"
    }
  - capture scalar drop __civreghdfe_K_endog
  - capture scalar drop __civreghdfe_K_exog
  - capture scalar drop __civreghdfe_K_iv
  - capture scalar drop __civreghdfe_G
  - capture scalar drop __civreghdfe_has_cluster
  - capture scalar drop __civreghdfe_has_weights
  - capture scalar drop __civreghdfe_weight_type
  - capture scalar drop __civreghdfe_vce_type
  - capture scalar drop __civreghdfe_maxiter
  - capture scalar drop __civreghdfe_tolerance
  - capture scalar drop __civreghdfe_verbose
  - capture scalar drop __civreghdfe_N
  - capture scalar drop __civreghdfe_df_r
  - capture scalar drop __civreghdfe_df_a
  - forval g = 1/20 {
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_1
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_2
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_3
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_4
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_5
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_6
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_7
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_8
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_9
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_10
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_11
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_12
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_13
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_14
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_15
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_16
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_17
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_18
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_19
  - }
  - capture scalar drop __civreghdfe_num_levels_`g'
  = capture scalar drop __civreghdfe_num_levels_20
  - }
  - capture scalar drop __civreghdfe_K
  - capture scalar drop __civreghdfe_rss
  - capture scalar drop __civreghdfe_tss
  - capture scalar drop __civreghdfe_r2
  - capture scalar drop __civreghdfe_rmse
  - capture scalar drop __civreghdfe_F
  - capture scalar drop __civreghdfe_N_clust
  - capture scalar drop __civreghdfe_nested_fe_index
  - capture scalar drop __civreghdfe_est_method
  - capture scalar drop __civreghdfe_kclass
  - capture scalar drop __civreghdfe_fuller
  - capture scalar drop __civreghdfe_coviv
  - capture scalar drop __civreghdfe_lambda
  - capture scalar drop __civreghdfe_kernel
  - capture scalar drop __civreghdfe_bw
  - capture scalar drop __civreghdfe_dkraay
  - capture scalar drop __civreghdfe_sargan
  - capture scalar drop __civreghdfe_sargan_df
  - capture scalar drop __civreghdfe_cd_f
  - capture scalar drop __civreghdfe_kp_f
  - capture scalar drop __civreghdfe_underid
  - capture scalar drop __civreghdfe_underid_df
  - capture scalar drop temp_underid
  - capture scalar drop temp_underid_df
  - capture scalar drop __civreghdfe_endog_chi2
  - capture scalar drop __civreghdfe_endog_f
  - capture scalar drop __civreghdfe_endog_df
  - capture scalar drop temp_sargan
  - capture scalar drop temp_sargan_df
  - capture scalar drop temp_cd_f
  - capture scalar drop temp_kp_f
  - capture scalar drop temp_endog_chi2
  - capture scalar drop temp_endog_f
  - capture scalar drop temp_endog_df
  - forvalues e = 1/`K_endog' {
  = forvalues e = 1/1 {
  - capture scalar drop __civreghdfe_F1_`e'
  = capture scalar drop __civreghdfe_F1_1
  - }
  - capture matrix drop __civreghdfe_b
  - capture matrix drop __civreghdfe_V
  ---------------------------------------------------------- end civreghdfe ---

. set trace off

. 
end of do-file

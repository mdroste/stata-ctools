
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user 16-core network, expiring  2 Jul 2026
Serial number: 501909320077
  Licensed to: Michael Droste
               Stanford University GSB

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running /Users/Mike/Documents/Stata/profile.do ...

. do /tmp/test_nolabel2.do 

. clear all

. set more off

. adopath ++ build
  [1]              "build"
  [2]  (BASE)      "/Applications/Stata/ado/base/"
  [3]  (SITE)      "/Applications/Stata/ado/site/"
  [4]              "."
  [5]  (PERSONAL)  "/Users/Mike/Documents/Stata/ado/personal/"
  [6]  (PLUS)      "/Users/Mike/Library/Application Support/Stata/ado/plus/"
  [7]  (OLDPLACE)  "~/ado/"

. 
. * Test nolabel option
. sysuse auto, clear
(1978 automobile data)

. gen id = _n

. keep id make price foreign

. tempfile master

. save `master'
file /var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St72468.000001 saved
    as .dta format

. 
. sysuse auto, clear
(1978 automobile data)

. gen id = _n

. keep id weight foreign

. note weight: "This is a test note"

. tempfile using_1

. save `using_1'
file /var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St72468.000002 saved
    as .dta format

. 
. * Test with nolabel and trace
. use `master', clear
(1978 automobile data)

. set trace on

. capture noisily cmerge 1:1 id using `using_1', nolabel noreport
  ------------------------------------------------------------ begin cmerge ---
  - version 14.0
  - gettoken merge_type 0 : 0, parse(" ")
  - local merge_code = -1
  - if "`merge_type'" == "1:1" {
  = if "1:1" == "1:1" {
  - local merge_code = 0
  - }
  - else if "`merge_type'" == "m:1" {
  = else if "1:1" == "m:1" {
    local merge_code = 1
    }
  - else if "`merge_type'" == "1:m" {
  = else if "1:1" == "1:m" {
    local merge_code = 2
    }
  - else if "`merge_type'" == "m:m" {
  = else if "1:1" == "m:m" {
    local merge_code = 3
    }
  - else {
    di as error "cmerge: invalid merge type `merge_type'"
    di as error "Must be one of: 1:1, m:1, 1:m, m:m"
    exit 198
    }
  - syntax varlist using/ [, Keep(string) ASSert(string) GENerate(name) NOGENer
> ate KEEPUSing(string) SORTED FORCE NOREPort Verbose NOLabel NONotes TIMEit UP
> DATE REPLACE PRESERVE_order(integer 0) ]
  - local keyvars `varlist'
  = local keyvars id
  - local nkeys : word count `keyvars'
  = local nkeys : word count id
  - if `nkeys' == 0 {
  = if 1 == 0 {
    di as error "cmerge: no key variables specified"
    exit 198
    }
  - if "`generate'" == "" & "`nogenerate'" == "" {
  = if "" == "" & "" == "" {
  - local generate "_merge"
  - }
  - if "`nogenerate'" == "" {
  = if "" == "" {
  - capture confirm variable `generate'
  = capture confirm variable _merge
  - if !_rc {
    di as error "variable `generate' already exists"
    di as error "use generate() option or drop `generate' first"
    exit 110
    }
  - }
  - local is_url = 0
  - if substr(`"`using'"', 1, 7) == "http://" | substr(`"`using'"', 1, 8) == "h
> ttps://" {
  = if substr(`"/var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St72468.00000
> 2"', 1, 7) == "http://" | substr(`"/var/folders/5l/0w9hn2t9637147hqnm7bgk0000
> 00gn/T//St72468.000002"', 1, 8) == "https://" {
    local is_url = 1
    }
  - if !`is_url' {
  = if !0 {
  - capture confirm file `"`using'"'
  = capture confirm file `"/var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St
> 72468.000002"'
  - if _rc {
    capture confirm file `"`using'.dta"'
    if _rc {
    di as error `"file `using' not found"'
    exit 601
    }
    local using `"`using'.dta"'
    }
  - }
  - local master_keytypes ""
  - foreach var of local keyvars {
  - capture confirm string variable `var'
  = capture confirm string variable id
  - if !_rc {
    local master_keytypes "`master_keytypes' str"
    }
  - else {
  - local master_keytypes "`master_keytypes' num"
  = local master_keytypes " num"
  - }
  - }
  - local master_nobs = _N
  - local master_nvars = c(k)
  - unab master_varlist : _all
    ------------------------------------------------------------ begin unab ---
    - version 6
    - gettoken user 0: 0, parse(" :")
    - gettoken colon 0: 0, parse(" :")
    - if `"`colon'"' != ":" { error 198 }
    = if `":"' != ":" { error 198 }
    - syntax [varlist(broken default=empty)] [, MIN(integer 1) MAX(integer 1200
> 00) NAME(string)]
    - c_local `user' `varlist'
    = c_local master_varlist make price foreign id
    - local n : word count `varlist'
    = local n : word count make price foreign id
    - if `n'>=`min' & `n'<=`max' { exit }
    = if 4>=1 & 4<=120000 { exit }
    -------------------------------------------------------------- end unab ---
  - if `master_nobs' == 0 {
  = if 74 == 0 {
    di as error "cmerge: no observations in master dataset"
    exit 2000
    }
  - local master_key_indices ""
  - local pos = 1
  - foreach v of local master_varlist {
  - foreach var of local keyvars {
  - if "`v'" == "`var'" {
  = if "make" == "id" {
    local master_key_indices "`master_key_indices' `pos'"
    }
  - }
  - local ++pos
  - }
  - foreach var of local keyvars {
  - if "`v'" == "`var'" {
  = if "price" == "id" {
    local master_key_indices "`master_key_indices' `pos'"
    }
  - }
  - local ++pos
  - }
  - foreach var of local keyvars {
  - if "`v'" == "`var'" {
  = if "foreign" == "id" {
    local master_key_indices "`master_key_indices' `pos'"
    }
  - }
  - local ++pos
  - }
  - foreach var of local keyvars {
  - if "`v'" == "`var'" {
  = if "id" == "id" {
  - local master_key_indices "`master_key_indices' `pos'"
  = local master_key_indices " 4"
  - }
  - }
  - local ++pos
  - }
  - local n_found : word count `master_key_indices'
  = local n_found : word count  4
  - if `n_found' != `nkeys' {
  = if 1 != 1 {
    di as error "cmerge: not all key variables found in master"
    exit 111
    }
  - if "`verbose'" != "" {
  = if "" != "" {
    di as text ""
    di as text "{hline 60}"
    di as text "cmerge: Optimized C-Accelerated Merge"
    di as text "{hline 60}"
    di as text "Merge type:  " as result "`merge_type'"
    di as text "Key vars:    " as result "`keyvars'"
    di as text "Using file:  " as result `"`using'"'
    di as text "Master obs:  " as result `master_nobs'
    di as text "Master vars: " as result `master_nvars'
    di as text "{hline 60}"
    di ""
    }
  - local __do_timing = ("`verbose'" != "" | "`timeit'" != "")
  = local __do_timing = ("" != "" | "" != "")
  - if `__do_timing' {
  = if 0 {
    timer clear 90
    timer clear 91
    timer clear 92
    timer clear 93
    timer clear 94
    timer clear 95
    timer on 90
    timer on 91
    }
  - capture program list ctools_plugin
  - if _rc != 0 {
  - local __os = c(os)
  - local __machine = c(machine_type)
  - local __is_mac = 0
  - if "`__os'" == "MacOSX" {
  = if "Unix" == "MacOSX" {
    local __is_mac = 1
    }
  - else if strpos(lower("`__machine'"), "mac") > 0 {
  = else if strpos(lower("Mac (Apple Silicon)"), "mac") > 0 {
  - local __is_mac = 1
  - }
  - local __plugin = ""
  - if "`__os'" == "Windows" {
  = if "Unix" == "Windows" {
    local __plugin "ctools_windows.plugin"
    }
  - else if `__is_mac' {
  = else if 1 {
  - local __is_arm = 0
  - if strpos(lower("`__machine'"), "apple") > 0 | strpos(lower("`__machine'"),
>  "arm") > 0 | strpos(lower("`__machine'"), "silicon") > 0 {
  = if strpos(lower("Mac (Apple Silicon)"), "apple") > 0 | strpos(lower("Mac (A
> pple Silicon)"), "arm") > 0 | strpos(lower("Mac (Apple Silicon)"), "silicon")
>  > 0 {
  - local __is_arm = 1
  - }
  - if `__is_arm' == 0 {
  = if 1 == 0 {
    tempfile __archfile
    quietly shell uname -m > "`__archfile'" 2>&1
    tempname __fh
    file open `__fh' using "`__archfile'", read text
    file read `__fh' __archline
    file close `__fh'
    capture erase "`__archfile'"
    if strpos("`__archline'", "arm64") > 0 {
    local __is_arm = 1
    }
    }
  - if `__is_arm' {
  = if 1 {
  - local __plugin "ctools_mac_arm.plugin"
  - }
  - else {
    local __plugin "ctools_mac_x86.plugin"
    }
  - }
  - else if "`__os'" == "Unix" {
  = else if "Unix" == "Unix" {
    local __plugin "ctools_linux.plugin"
    }
  - else {
    local __plugin "ctools.plugin"
    }
  - capture program ctools_plugin, plugin using("`__plugin'")
  = capture program ctools_plugin, plugin using("ctools_mac_arm.plugin")
  - if _rc != 0 & _rc != 110 & "`__plugin'" != "ctools.plugin" {
  = if _rc != 0 & _rc != 110 & "ctools_mac_arm.plugin" != "ctools.plugin" {
    capture program ctools_plugin, plugin using("ctools.plugin")
    }
  - if _rc != 0 & _rc != 110 {
    di as error "cmerge: Could not load ctools plugin"
    exit 601
    }
  - }
  - if "`verbose'" != "" {
  = if "" != "" {
    di as text "Phase 1: Loading using dataset (keys + keepusing only)..."
    }
  - preserve
  - qui use `"`using'"', clear
  = qui use `"/var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St72468.000002"
> ', clear
  - foreach var of local keyvars {
  - capture confirm variable `var'
  = capture confirm variable id
  - if _rc {
    di as error "cmerge: key variable `var' not found in using dataset"
    restore
    exit 111
    }
  - }
  - local i = 1
  - foreach var of local keyvars {
  - local master_type : word `i' of `master_keytypes'
  = local master_type : word 1 of  num
  - capture confirm string variable `var'
  = capture confirm string variable id
  - if !_rc {
    local using_type "str"
    }
  - else {
  - local using_type "num"
  - }
  - if "`master_type'" != "`using_type'" {
  = if "num" != "num" {
    if "`force'" == "" {
    di as error "cmerge: key variable `var' is `master_type' in master but `usi
> ng_type' in using"
    di as error "use force option to override"
    restore
    exit 106
    }
    }
  - local ++i
  - }
  - local using_keep_vars "`keyvars'"
  = local using_keep_vars "id"
  - local keepusing_count = 0
  - local keepusing_names ""
  - local keepusing_types ""
  - if "`keepusing'" != "" {
  = if "" != "" {
    foreach var of local keepusing {
    capture confirm variable `var'
    if _rc {
    di as error "cmerge: keepusing variable `var' not found in using dataset"
    restore
    exit 111
    }
    local using_keep_vars "`using_keep_vars' `var'"
    local keepusing_names "`keepusing_names' `var'"
    local ++keepusing_count
    local vtype : type `var'
    local keepusing_types "`keepusing_types' `vtype'"
    }
    }
  - else {
  - unab all_using_vars : _all
    ------------------------------------------------------------ begin unab ---
    - version 6
    - gettoken user 0: 0, parse(" :")
    - gettoken colon 0: 0, parse(" :")
    - if `"`colon'"' != ":" { error 198 }
    = if `":"' != ":" { error 198 }
    - syntax [varlist(broken default=empty)] [, MIN(integer 1) MAX(integer 1200
> 00) NAME(string)]
    - c_local `user' `varlist'
    = c_local all_using_vars weight foreign id
    - local n : word count `varlist'
    = local n : word count weight foreign id
    - if `n'>=`min' & `n'<=`max' { exit }
    = if 3>=1 & 3<=120000 { exit }
    -------------------------------------------------------------- end unab ---
  - foreach var of local all_using_vars {
  - local is_key = 0
  - foreach k of local keyvars {
  - if "`var'" == "`k'" {
  = if "weight" == "id" {
    local is_key = 1
    }
  - }
  - if !`is_key' {
  = if !0 {
  - local keepusing_names "`keepusing_names' `var'"
  = local keepusing_names " weight"
  - local ++keepusing_count
  - local vtype : type `var'
  = local vtype : type weight
  - local keepusing_types "`keepusing_types' `vtype'"
  = local keepusing_types " int"
  - }
  - }
  - local is_key = 0
  - foreach k of local keyvars {
  - if "`var'" == "`k'" {
  = if "foreign" == "id" {
    local is_key = 1
    }
  - }
  - if !`is_key' {
  = if !0 {
  - local keepusing_names "`keepusing_names' `var'"
  = local keepusing_names " weight foreign"
  - local ++keepusing_count
  - local vtype : type `var'
  = local vtype : type foreign
  - local keepusing_types "`keepusing_types' `vtype'"
  = local keepusing_types " int byte"
  - }
  - }
  - local is_key = 0
  - foreach k of local keyvars {
  - if "`var'" == "`k'" {
  = if "id" == "id" {
  - local is_key = 1
  - }
  - }
  - if !`is_key' {
  = if !1 {
    local keepusing_names "`keepusing_names' `var'"
    local ++keepusing_count
    local vtype : type `var'
    local keepusing_types "`keepusing_types' `vtype'"
    }
  - }
  - local using_keep_vars "`keyvars' `keepusing_names'"
  = local using_keep_vars "id  weight foreign"
  - }
  - if "`nonotes'" == "" {
  = if "" == "" {
  - foreach var of local keepusing_names {
  - local `var'_note : char `var'[note1]
  = local weight_note : char weight[note1]
  - }
  - local `var'_note : char `var'[note1]
  = local foreign_note : char foreign[note1]
  - }
  - }
  - local shared_var_flags ""
  - foreach vname of local keepusing_names {
  - local is_shared = 0
  - foreach mvar of local master_varlist {
  - if "`mvar'" == "`vname'" {
  = if "make" == "weight" {
    local is_shared = 1
    continue, break
    }
  - }
  - if "`mvar'" == "`vname'" {
  = if "price" == "weight" {
    local is_shared = 1
    continue, break
    }
  - }
  - if "`mvar'" == "`vname'" {
  = if "foreign" == "weight" {
    local is_shared = 1
    continue, break
    }
  - }
  - if "`mvar'" == "`vname'" {
  = if "id" == "weight" {
    local is_shared = 1
    continue, break
    }
  - }
  - local shared_var_flags "`shared_var_flags' `is_shared'"
  = local shared_var_flags " 0"
  - }
  - local is_shared = 0
  - foreach mvar of local master_varlist {
  - if "`mvar'" == "`vname'" {
  = if "make" == "foreign" {
    local is_shared = 1
    continue, break
    }
  - }
  - if "`mvar'" == "`vname'" {
  = if "price" == "foreign" {
    local is_shared = 1
    continue, break
    }
  - }
  - if "`mvar'" == "`vname'" {
  = if "foreign" == "foreign" {
  - local is_shared = 1
  - continue, break
    }
    }
  - local shared_var_flags "`shared_var_flags' `is_shared'"
  = local shared_var_flags " 0 1"
  - }
  - local using_label_list ""
  - local using_label_varmap ""
  - if "`nolabel'" == "" {
  = if "nolabel" == "" {
    qui label dir
    local using_label_list "`r(names)'"
    foreach var of local keepusing_names {
    local vallbl : value label `var'
    if "`vallbl'" != "" {
    local using_label_varmap "`using_label_varmap' `var':`vallbl'"
    }
    }
    if "`using_label_list'" != "" {
    tempfile using_labels_file
    qui label save `using_label_list' using "`using_labels_file'", replace
    }
    }
  - qui keep `using_keep_vars'
  = qui keep id  weight foreign
  - local using_nobs = _N
  - if "`verbose'" != "" {
  = if "" != "" {
    di as text "  Using: " as result `using_nobs' as text " obs, keeping " as r
> esult `nkeys' as text " keys + " as result `keepusing_count' as text " keepus
> ing vars"
    }
  - local using_key_indices ""
  - local using_keepusing_indices ""
  - local pos = 1
  - unab using_varlist : _all
    ------------------------------------------------------------ begin unab ---
    - version 6
    - gettoken user 0: 0, parse(" :")
    - gettoken colon 0: 0, parse(" :")
    - if `"`colon'"' != ":" { error 198 }
    = if `":"' != ":" { error 198 }
    - syntax [varlist(broken default=empty)] [, MIN(integer 1) MAX(integer 1200
> 00) NAME(string)]
    - c_local `user' `varlist'
    = c_local using_varlist weight foreign id
    - local n : word count `varlist'
    = local n : word count weight foreign id
    - if `n'>=`min' & `n'<=`max' { exit }
    = if 3>=1 & 3<=120000 { exit }
    -------------------------------------------------------------- end unab ---
  - foreach v of local using_varlist {
  - local is_key = 0
  - foreach k of local keyvars {
  - if "`v'" == "`k'" {
  = if "weight" == "id" {
    local using_key_indices "`using_key_indices' `pos'"
    local is_key = 1
    }
  - }
  - if !`is_key' {
  = if !0 {
  - local using_keepusing_indices "`using_keepusing_indices' `pos'"
  = local using_keepusing_indices " 1"
  - }
  - local ++pos
  - }
  - local is_key = 0
  - foreach k of local keyvars {
  - if "`v'" == "`k'" {
  = if "foreign" == "id" {
    local using_key_indices "`using_key_indices' `pos'"
    local is_key = 1
    }
  - }
  - if !`is_key' {
  = if !0 {
  - local using_keepusing_indices "`using_keepusing_indices' `pos'"
  = local using_keepusing_indices " 1 2"
  - }
  - local ++pos
  - }
  - local is_key = 0
  - foreach k of local keyvars {
  - if "`v'" == "`k'" {
  = if "id" == "id" {
  - local using_key_indices "`using_key_indices' `pos'"
  = local using_key_indices " 3"
  - local is_key = 1
  - }
  - }
  - if !`is_key' {
  = if !1 {
    local using_keepusing_indices "`using_keepusing_indices' `pos'"
    }
  - local ++pos
  - }
  - local plugin_args "load_using `nkeys' `using_key_indices'"
  = local plugin_args "load_using 1  3"
  - local plugin_args "`plugin_args' n_keepusing `keepusing_count'"
  = local plugin_args "load_using 1  3 n_keepusing 2"
  - if `keepusing_count' > 0 {
  = if 2 > 0 {
  - local plugin_args "`plugin_args' keepusing_indices `using_keepusing_indices
> '"
  = local plugin_args "load_using 1  3 n_keepusing 2 keepusing_indices  1 2"
  - }
  - if "`verbose'" != "" {
  = if "" != "" {
    local plugin_args "`plugin_args' verbose"
    }
  - if "`sorted'" != "" {
  = if "" != "" {
    local plugin_args "`plugin_args' sorted"
    }
  - if `__do_timing' {
  = if 0 {
    timer off 91
    timer on 92
    }
  - capture noisily plugin call ctools_plugin `using_varlist', "cmerge `plugin_
> args'"
  = capture noisily plugin call ctools_plugin weight foreign id, "cmerge load_u
> sing 1  3 n_keepusing 2 keepusing_indices  1 2"
  - local plugin_rc = _rc
  - if `__do_timing' {
  = if 0 {
    timer off 92
    }
  - if `plugin_rc' {
  = if 0 {
    di as error "cmerge: failed to load using data (error `plugin_rc')"
    restore
    exit `plugin_rc'
    }
  - if `__do_timing' {
  = if 0 {
    timer on 93
    }
  - if "`verbose'" != "" {
  = if "" != "" {
    di as text ""
    di as text "Phase 2: Executing merge with streaming..."
    }
  - if `__do_timing' {
  = if 0 {
    timer clear 96
    timer clear 97
    timer clear 98
    timer clear 99
    timer on 97
    }
  - local new_var_names "_cmerge_orig_row"
  - local new_var_types "long"
  - local placeholder_num = 1
  - foreach vtype of local keepusing_types {
  - local vname : word `placeholder_num' of `keepusing_names'
  = local vname : word 1 of  weight foreign
  - local is_shared : word `placeholder_num' of `shared_var_flags'
  = local is_shared : word 1 of  0 1
  - if `is_shared' == 0 {
  = if 0 == 0 {
  - local new_var_names "`new_var_names' `vname'"
  = local new_var_names "_cmerge_orig_row weight"
  - local new_var_types "`new_var_types' `vtype'"
  = local new_var_types "long int"
  - }
  - local ++placeholder_num
  - }
  - local vname : word `placeholder_num' of `keepusing_names'
  = local vname : word 2 of  weight foreign
  - local is_shared : word `placeholder_num' of `shared_var_flags'
  = local is_shared : word 2 of  0 1
  - if `is_shared' == 0 {
  = if 1 == 0 {
    local new_var_names "`new_var_names' `vname'"
    local new_var_types "`new_var_types' `vtype'"
    }
  - local ++placeholder_num
  - }
  - if "`nogenerate'" == "" {
  = if "" == "" {
  - local new_var_names "`new_var_names' `generate'"
  = local new_var_names "_cmerge_orig_row weight _merge"
  - local new_var_types "`new_var_types' byte"
  = local new_var_types "long int byte"
  - }
  - local n_new_vars : word count `new_var_names'
  = local n_new_vars : word count _cmerge_orig_row weight _merge
  - tempfile empty_vars_template
  - if `n_new_vars' > 0 {
  = if 3 > 0 {
  - clear
    ----------------------------------------------------------- begin clear ---
    - if _caller() < 10 {
      _clear_9 `0'
      exit
      }
    - version 10
    - syntax [anything]
    - tokenize `anything'
    = tokenize 
    - if `"`2'"' != "" {
    = if `""' != "" {
      display as err "`2' not allowed"
      exit 198
      }
    - if "`1'"=="" {
    = if ""=="" {
    - drop _all
    - label drop _all
      --------------------------------------------------------- begin label ---
      - version 10.0
      - local vv : display "version " string(_caller()) ", missing:"
      - gettoken val : 0
      - if (strpos("`val'", "val") > 0 ) {
      = if (strpos("drop", "val") > 0 ) {
        gettoken val 0 : 0
        syntax anything [, nofix]
        if "`fix'" != "" {
        local fix ", nofix"
        }
        gettoken var rest : anything
        while `"`rest'"' != "" {
        gettoken lab rest : rest
        local label "`lab'"
        }
        local vlist : list anything - lab
        if "`lab'" == "." {
        local lab ""
        }
        foreach var of varlist `vlist' {
        `vv' _label `val' `var' `lab' `fix'
        }
        }
      - else {
      - `vv' _label `macval(0)'
      = version 10, missing: _label drop _all
      - }
      ----------------------------------------------------------- end label ---
    - }
    - else if "`1'"=="collect" {
    = else if ""=="collect" {
      collect clear
      }
    - else if "`1'"=="frames" {
    = else if ""=="frames" {
      frames reset
      }
    - else if "`1'"=="mata" {
    = else if ""=="mata" {
      mata: mata clear
      }
    - else if "`1'"=="python" {
    = else if ""=="python" {
      python clear
      }
    - else if "`1'"=="java" {
    = else if ""=="java" {
      java clear
      }
    - else if inlist("`1'", "results", "matrix") {
    = else if inlist("", "results", "matrix") {
      return clear
      clearreturn
      ereturn clear
      sreturn clear
      _return drop _all
      if ("`1'" == "matrix") {
      matrix drop _all
      _est drop _all
      }
      }
    - else if "`1'"=="programs" {
    = else if ""=="programs" {
      program drop _all
      }
    - else if "`1'"=="ado" {
    = else if ""=="ado" {
      program drop _allado
      }
    - else if "`1'"=="rngstream" | "`1'"=="rngstreams" {
    = else if ""=="rngstream" | ""=="rngstreams" {
      set rngstream clear
      }
    - else if "`1'"=="*" | "`1'"=="all" {
    = else if ""=="*" | ""=="all" {
      capture mata: st_local("semmods", strofreal(sg__global.hasmodels()))
      capture
      if (0`semmods') {
      display as err "-clear all- not allowed while an SEM Builder is open"
      exit 1
      }
      drop _all
      frames reset
      label drop _all
      matrix drop _all
      scalar drop _all
      constraint drop _all
      eq drop _all
      file close _all
      postutil clear
      _return drop _all
      discard
      collect clear
      program drop _all
      timer clear
      mata: _st__put_cmd_clear()
      mata: mata clear
      python clear
      java clear
      }
    - else {
      display as err "`1' not allowed"
      exit 198
      }
    ------------------------------------------------------------- end clear ---
  - qui set obs 1
  - local var_idx = 1
  - foreach vtype of local new_var_types {
  - local vname : word `var_idx' of `new_var_names'
  = local vname : word 1 of _cmerge_orig_row weight _merge
  - if substr("`vtype'", 1, 3) == "str" {
  = if substr("long", 1, 3) == "str" {
    qui gen `vtype' `vname' = ""
    }
  - else {
  - qui gen `vtype' `vname' = .
  = qui gen long _cmerge_orig_row = .
  - }
  - local ++var_idx
  - }
  - local vname : word `var_idx' of `new_var_names'
  = local vname : word 2 of _cmerge_orig_row weight _merge
  - if substr("`vtype'", 1, 3) == "str" {
  = if substr("int", 1, 3) == "str" {
    qui gen `vtype' `vname' = ""
    }
  - else {
  - qui gen `vtype' `vname' = .
  = qui gen int weight = .
  - }
  - local ++var_idx
  - }
  - local vname : word `var_idx' of `new_var_names'
  = local vname : word 3 of _cmerge_orig_row weight _merge
  - if substr("`vtype'", 1, 3) == "str" {
  = if substr("byte", 1, 3) == "str" {
    qui gen `vtype' `vname' = ""
    }
  - else {
  - qui gen `vtype' `vname' = .
  = qui gen byte _merge = .
  - }
  - local ++var_idx
  - }
  - qui drop in 1
  - qui save `empty_vars_template', emptyok replace
  = qui save /var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St72468.000004, 
> emptyok replace
  - }
  - if `__do_timing' {
  = if 0 {
    timer off 97
    timer on 96
    }
  - restore
  - if `__do_timing' {
  = if 0 {
    timer off 96
    timer on 97
    }
  - if `n_new_vars' > 0 {
  = if 3 > 0 {
  - qui append using `empty_vars_template'
  = qui append using /var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St72468.
> 000004
    ---------------------------------------------------------- begin append ---
    - version 11
    - if (_caller() < 11) {
      local version : di "version " string(_caller()) ":"
      `version' _append `0'
      exit
      }
    - syntax [anything(everything)] [, GENerate(name) * ]
    - gettoken using filenames : anything
    - if (`"`using'"' != "using") {
    = if (`"using"' != "using") {
      di as err "using required"
      exit 100
      }
    - if (`"`filenames'"' == "") {
    = if (`" /var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St72468.000004"'
>  == "") {
      di as err "invalid file specification"
      exit 198
      }
    - foreach filename of local filenames {
    - capture quietly describe using `"`filename'"'
    = capture quietly describe using `"/var/folders/5l/0w9hn2t9637147hqnm7bgk00
> 0000gn/T//St72468.000004"'
      ------------------------------------------------------ begin describe ---
      - version 9
      - local version : di "version " string(_caller()) ":"
      - syntax [anything] [using] [, SImple REPLACE *]
      - if ("`replace'"!="") {
      = if (""!="") {
        describe_mk `0'
        return add
        exit
        }
      - local varlist `"`anything'"'
      = local varlist `""'
      - if ("`simple'" == "") {
      = if ("" == "") {
      - `version' _describe `0'
      = version 11: _describe using `"/var/folders/5l/0w9hn2t9637147hqnm7bgk000
> 000gn/T//St72468.000004"'
      - return add
      - }
      - else {
        if (`"`options'"' != "") {
        di as err "simple may not be combined with other options"
        exit 198
        }
        if (`"`using'"' != "") {
        qui `version' describe `varlist' `using', varlist
        if "`varlist'" == "" {
        local vars "`r(varlist)'"
        }
        else {
        local vars "`varlist'"
        }
        local wid = 2
        local n : list sizeof vars
        if `n'==0 {
        exit
        }
        if "`c(hasicu)'" == "1" {
        foreach x of local vars {
        local wid = max(`wid', udstrlen(`"`x'"'))
        }
        }
        else {
        foreach x of local vars {
        local wid = max(`wid', strlen(`"`x'"'))
        }
        }
        local wid = `wid' + 2
        local cols = int((`c(linesize)'+1)/`wid')
        if `cols' < 2 {
        foreach x of local `vars' {
        di as txt `col' `"`x'"'
        }
        exit
        }
        local lines = `n'/`cols'
        local lines = int(cond(`lines'>int(`lines'), `lines'+1, `lines'))
        forvalues i=1(1)`lines' {
        local top = min((`cols')*`lines'+`i', `n')
        local col = 1
        forvalues j=`i'(`lines')`top' {
        local x : word `j' of `vars'
        di as txt _column(`col') "`x'" _c
        local col = `col' + `wid'
        }
        di as txt
        }
        qui `version' describe `varlist' `using', short
        return add
        }
        else {
        ds `varlist'
        qui `version' _describe `varlist', short
        return add
        }
        }
      -------------------------------------------------------- end describe ---
    - if (_rc) {
      di as err `"file `filename' not found"'
      exit 601
      }
    - }
    - if ("`generate'" != "") {
    = if ("" != "") {
      confirm new var `generate'
      local filenum 0
      gen byte `generate' = `filenum'
      label variable `generate' "Dataset source"
      local value_label 0
      mata:st_local("value_label",__import_check_value_label_name("_append", "_
> _append"))
      label define `value_label' 0 "Master"
      label values `generate' `value_label'
      local ++filenum
      local filenumpos = _N + 1
      }
    - foreach filename of local filenames {
    - capture noisily _append using `"`filename'"', `options'
    = capture noisily _append using `"/var/folders/5l/0w9hn2t9637147hqnm7bgk000
> 000gn/T//St72468.000004"', 
    - if _rc {
      if ("`generate'" != "") {
      capture quietly drop if `generate' > 0
      capture quietly drop `generate'
      }
      exit _rc
      }
    - if ("`generate'" != "") {
    = if ("" != "") {
      quietly replace `generate' = `filenum' in `filenumpos'/L
      label define `value_label' `filenum' "Appended dataset `filenum'", add
      local ++filenum
      local filenumpos = _N + 1
      }
    - }
    ------------------------------------------------------------ end append ---
  - }
  - if `__do_timing' {
  = if 0 {
    timer off 97
    timer on 99
    }
  - local orig_row_idx = c(k) - `n_new_vars' + 1
  = local orig_row_idx = c(k) - 3 + 1
  - mata: st_store(., `orig_row_idx', (1::st_nobs()))
  = mata: st_store(., 5, (1::st_nobs()))
  - if `__do_timing' {
  = if 0 {
    timer off 99
    }
  - local keepusing_placeholder_indices ""
  - unab current_varlist : _all
    ------------------------------------------------------------ begin unab ---
    - version 6
    - gettoken user 0: 0, parse(" :")
    - gettoken colon 0: 0, parse(" :")
    - if `"`colon'"' != ":" { error 198 }
    = if `":"' != ":" { error 198 }
    - syntax [varlist(broken default=empty)] [, MIN(integer 1) MAX(integer 1200
> 00) NAME(string)]
    - c_local `user' `varlist'
    = c_local current_varlist make price foreign id _cmerge_orig_row weight _me
> rge
    - local n : word count `varlist'
    = local n : word count make price foreign id _cmerge_orig_row weight _merge
    - if `n'>=`min' & `n'<=`max' { exit }
    = if 7>=1 & 7<=120000 { exit }
    -------------------------------------------------------------- end unab ---
  - foreach vname of local keepusing_names {
  - local pos = 1
  - foreach v of local current_varlist {
  - if "`v'" == "`vname'" {
  = if "make" == "weight" {
    local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
    continue, break
    }
  - local ++pos
  - }
  - if "`v'" == "`vname'" {
  = if "price" == "weight" {
    local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
    continue, break
    }
  - local ++pos
  - }
  - if "`v'" == "`vname'" {
  = if "foreign" == "weight" {
    local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
    continue, break
    }
  - local ++pos
  - }
  - if "`v'" == "`vname'" {
  = if "id" == "weight" {
    local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
    continue, break
    }
  - local ++pos
  - }
  - if "`v'" == "`vname'" {
  = if "_cmerge_orig_row" == "weight" {
    local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
    continue, break
    }
  - local ++pos
  - }
  - if "`v'" == "`vname'" {
  = if "weight" == "weight" {
  - local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
  = local keepusing_placeholder_indices " 6"
  - continue, break
    }
    local ++pos
    }
  - }
  - local pos = 1
  - foreach v of local current_varlist {
  - if "`v'" == "`vname'" {
  = if "make" == "foreign" {
    local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
    continue, break
    }
  - local ++pos
  - }
  - if "`v'" == "`vname'" {
  = if "price" == "foreign" {
    local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
    continue, break
    }
  - local ++pos
  - }
  - if "`v'" == "`vname'" {
  = if "foreign" == "foreign" {
  - local keepusing_placeholder_indices "`keepusing_placeholder_indices' `pos'"
  = local keepusing_placeholder_indices " 6 3"
  - continue, break
    }
    local ++pos
    }
  - }
  - local merge_var_idx = 0
  - if "`nogenerate'" == "" {
  = if "" == "" {
  - local merge_var_idx = c(k)
  - }
  - if `__do_timing' {
  = if 0 {
    timer off 97
    timer on 98
    }
  - local max_output = `master_nobs' + `using_nobs'
  = local max_output = 74 + 74
  - if `max_output' > _N {
  = if 148 > _N {
  - qui set obs `max_output'
  = qui set obs 148
  - }
  - if `__do_timing' {
  = if 0 {
    timer off 98
    }
  - local current_nvars = c(k)
  - local plugin_args "execute `merge_code' `nkeys' `master_key_indices'"
  = local plugin_args "execute 0 1  4"
  - local plugin_args "`plugin_args' orig_row_idx `orig_row_idx'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5"
  - local plugin_args "`plugin_args' master_nobs `master_nobs'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5 master_nobs 74"
  - local plugin_args "`plugin_args' master_nvars `current_nvars'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5 master_nobs 74 master_nvar
> s 7"
  - local plugin_args "`plugin_args' n_keepusing `keepusing_count'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5 master_nobs 74 master_nvar
> s 7 n_keepusing 2"
  - if `keepusing_count' > 0 {
  = if 2 > 0 {
  - local plugin_args "`plugin_args' keepusing_placeholders `keepusing_placehol
> der_indices'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5 master_nobs 74 master_nvar
> s 7 n_keepusing 2 keepusing_placeholders  6 3"
  - }
  - if "`nogenerate'" == "" {
  = if "" == "" {
  - local plugin_args "`plugin_args' merge_var_idx `merge_var_idx'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5 master_nobs 74 master_nvar
> s 7 n_keepusing 2 keepusing_placeholders  6 3 merge_var_idx 7"
  - }
  - local plugin_args "`plugin_args' preserve_order `preserve_order'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5 master_nobs 74 master_nvar
> s 7 n_keepusing 2 keepusing_placeholders  6 3 merge_var_idx 7 preserve_order 
> 0"
  - if "`verbose'" != "" {
  = if "" != "" {
    local plugin_args "`plugin_args' verbose"
    }
  - if "`sorted'" != "" {
  = if "" != "" {
    local plugin_args "`plugin_args' sorted"
    }
  - if "`update'" != "" {
  = if "" != "" {
    local plugin_args "`plugin_args' update"
    }
  - if "`replace'" != "" {
  = if "" != "" {
    local plugin_args "`plugin_args' replace"
    }
  - if `keepusing_count' > 0 {
  = if 2 > 0 {
  - local plugin_args "`plugin_args' shared_flags `shared_var_flags'"
  = local plugin_args "execute 0 1  4 orig_row_idx 5 master_nobs 74 master_nvar
> s 7 n_keepusing 2 keepusing_placeholders  6 3 merge_var_idx 7 preserve_order 
> 0 shared_flags  0 1"
  - }
  - if `__do_timing' {
  = if 0 {
    timer off 93
    timer on 94
    }
  - capture noisily plugin call ctools_plugin `current_varlist', "cmerge `plugi
> n_args'"
  = capture noisily plugin call ctools_plugin make price foreign id _cmerge_ori
> g_row weight _merge, "cmerge execute 0 1  4 orig_row_idx 5 master_nobs 74 mas
> ter_nvars 7 n_keepusing 2 keepusing_placeholders  6 3 merge_var_idx 7 preserv
> e_order 0 shared_flags  0 1"
  - local plugin_rc = _rc
  - if `__do_timing' {
  = if 0 {
    timer off 94
    timer on 95
    }
  - if `plugin_rc' {
  = if 0 {
    di as error "cmerge: C plugin merge failed (error `plugin_rc')"
    capture drop _cmerge_orig_row
    exit `plugin_rc'
    }
  - local merge_master = scalar(_cmerge_N_1)
  - local merge_using = scalar(_cmerge_N_2)
  - local merge_matched = scalar(_cmerge_N_3)
  - local total_obs = scalar(_cmerge_N)
  - qui capture drop _cmerge_orig_row
  - if `total_obs' < _N {
  = if 74 < _N {
  - qui keep in 1/`total_obs'
  = qui keep in 1/74
  - }
  - if "`nonotes'" == "" {
  = if "" == "" {
  - foreach var of local keepusing_names {
  - if "``var'_note'" != "" {
  = if ""This is a test note"" != "" {
type mismatch
    char `var'[note1] ``var'_note'
    }
    }
  -------------------------------------------------------------- end cmerge ---

. set trace off

. di "Return code: `=_rc'"
Return code: 109

. 
end of do-file

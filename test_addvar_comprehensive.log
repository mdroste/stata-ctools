
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 18.5
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user 16-core network, expiring  2 Jul 2026
Serial number: 501909320077
  Licensed to: Michael Droste
               Stanford University GSB

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running /Users/Mike/Documents/Stata/profile.do ...

. do test_addvar_comprehensive.do 

. * Comprehensive test of ALL variable creation methods
. clear all

. set more off

. 
. local classpath "/Users/Mike/Documents/GitHub/stata-ctools"

. 
. * Create dataset WITH data - 100M obs, 20 existing vars
. di "Creating test dataset..."
Creating test dataset...

. set obs 100000000
Number of observations (_N) was 0, now 100,000,000.

. forval i = 1/20 {
  2.     qui gen x`i' = rnormal()
  3. }

. gen g = ceil(runiform()*100000)

. 
. di "Dataset has " c(k) " variables, " _N " observations"
Dataset has 21 variables, 1.000e+08 observations

. di ""


. 
. * ===========================================================================
> =
. * Test 1: Stata gen (sequential)
. * ===========================================================================
> =
. di "Test 1: Stata gen sequential (24 vars)..."
Test 1: Stata gen sequential (24 vars)...

. timer clear 1

. timer on 1

. qui gen double v0 = .

. qui gen double v1 = .

. qui gen double v2 = .

. qui gen double v3 = .

. qui gen double v4 = .

. qui gen double v5 = .

. qui gen double v6 = .

. qui gen double v7 = .

. qui gen double v8 = .

. qui gen double v9 = .

. qui gen double v10 = .

. qui gen double v11 = .

. qui gen double v12 = .

. qui gen double v13 = .

. qui gen double v14 = .

. qui gen double v15 = .

. qui gen double v16 = .

. qui gen double v17 = .

. qui gen double v18 = .

. qui gen double v19 = .

. qui gen double v20 = .

. qui gen double v21 = .

. qui gen double v22 = .

. qui gen double v23 = .

. timer off 1

. timer list 1
   1:     18.19 /        1 =      18.1930

. drop v0-v23

. 
. * ===========================================================================
> =
. * Test 2: Mata st_addvar (with initialization)
. * ===========================================================================
> =
. di _n "Test 2: Mata st_addvar (24 vars, initializes to missing)..."

Test 2: Mata st_addvar (24 vars, initializes to missing)...

. timer clear 2

. timer on 2

. mata: st_addvar(("double","double","double","double","double","double","doubl
> e","double","double","double","double","double","double","double","double","d
> ouble","double","double","double","double","double","double","double","double
> "), ("v0","v1","v2","v3","v4","v5","v6","v7","v8","v9","v10","v11","v12","v13
> ","v14","v15","v16","v17","v18","v19","v20","v21","v22","v23"))
        1    2    3    4    5    6    7    8    9   10   11   12   13   14
    +-----------------------------------------------------------------------
  1 |  22   23   24   25   26   27   28   29   30   31   32   33   34   35
    +-----------------------------------------------------------------------
       15   16   17   18   19   20   21   22   23   24
     ---------------------------------------------------+
  1    36   37   38   39   40   41   42   43   44   45  |
     ---------------------------------------------------+

. timer off 2

. timer list 2
   2:     11.40 /        1 =      11.3970

. drop v0-v23

. 
. * ===========================================================================
> =
. * Test 3: Mata _st_addvar (without initialization)
. * ===========================================================================
> =
. di _n "Test 3: Mata _st_addvar (24 vars, no initialization)..."

Test 3: Mata _st_addvar (24 vars, no initialization)...

. timer clear 3

. timer on 3

. mata: _st_addvar(("double","double","double","double","double","double","doub
> le","double","double","double","double","double","double","double","double","
> double","double","double","double","double","double","double","double","doubl
> e"), ("v0","v1","v2","v3","v4","v5","v6","v7","v8","v9","v10","v11","v12","v1
> 3","v14","v15","v16","v17","v18","v19","v20","v21","v22","v23"))
        1    2    3    4    5    6    7    8    9   10   11   12   13   14
    +-----------------------------------------------------------------------
  1 |  22   23   24   25   26   27   28   29   30   31   32   33   34   35
    +-----------------------------------------------------------------------
       15   16   17   18   19   20   21   22   23   24
     ---------------------------------------------------+
  1    36   37   38   39   40   41   42   43   44   45  |
     ---------------------------------------------------+

. timer off 3

. timer list 3
   3:     11.21 /        1 =      11.2080

. drop v0-v23

. 
. * ===========================================================================
> =
. * Test 4: Java AddVarBatch
. * ===========================================================================
> =
. di _n "Test 4: Java AddVarBatch (24 vars)..."

Test 4: Java AddVarBatch (24 vars)...

. local types "double+double+double+double+double+double+double+double+double+d
> ouble+double+double+double+double+double+double+double+double+double+double+d
> ouble+double+double+double"

. local names "v0+v1+v2+v3+v4+v5+v6+v7+v8+v9+v10+v11+v12+v13+v14+v15+v16+v17+v1
> 8+v19+v20+v21+v22+v23"

. timer clear 4

. timer on 4

. javacall AddVarBatch create, classpath(`classpath') args(`types' `names')

. timer off 4

. timer list 4
   4:     11.62 /        1 =      11.6240

. drop v0-v23

. 
. * ===========================================================================
> =
. * Test 5: Mata loop calling st_addvar one at a time
. * ===========================================================================
> =
. di _n "Test 5: Mata loop st_addvar (24 individual calls)..."

Test 5: Mata loop st_addvar (24 individual calls)...

. timer clear 5

. timer on 5

. forval i = 0/23 {
  2.     mata: st_addvar("double", "v`i'")
  3. }
  22
  23
  24
  25
  26
  27
  28
  29
  30
  31
  32
  33
  34
  35
  36
  37
  38
  39
  40
  41
  42
  43
  44
  45

. timer off 5

. timer list 5
   5:     11.21 /        1 =      11.2120

. drop v0-v23

. 
. * ===========================================================================
> =
. * Test 6: Append empty dataset trick
. * ===========================================================================
> =
. di _n "Test 6: Append empty dataset with vars (0 obs)..."

Test 6: Append empty dataset with vars (0 obs)...

. 
. * First create the empty template dataset
. preserve

. clear

. gen double v0 = .

. gen double v1 = .

. gen double v2 = .

. gen double v3 = .

. gen double v4 = .

. gen double v5 = .

. gen double v6 = .

. gen double v7 = .

. gen double v8 = .

. gen double v9 = .

. gen double v10 = .

. gen double v11 = .

. gen double v12 = .

. gen double v13 = .

. gen double v14 = .

. gen double v15 = .

. gen double v16 = .

. gen double v17 = .

. gen double v18 = .

. gen double v19 = .

. gen double v20 = .

. gen double v21 = .

. gen double v22 = .

. gen double v23 = .

. drop if 1  // Make it 0 obs
(0 observations deleted)

. tempfile empty_vars

. save `empty_vars'
(dataset contains 0 observations)
file /var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St95094.000002 saved
    as .dta format

. restore

. 
. timer clear 6

. timer on 6

. append using `empty_vars'

. timer off 6

. timer list 6
   6:      2.48 /        1 =       2.4760

. drop v0-v23

. 
. * ===========================================================================
> =
. * Test 7: Append empty dataset - measure including creation
. * ===========================================================================
> =
. di _n "Test 7: Append empty dataset (including tempfile creation)..."

Test 7: Append empty dataset (including tempfile creation)...

. timer clear 7

. timer on 7

. preserve

. clear

. forval i = 0/23 {
  2.     gen double v`i' = .
  3. }

. drop if 1
(0 observations deleted)

. tempfile empty_vars2

. save `empty_vars2'
(dataset contains 0 observations)
file /var/folders/5l/0w9hn2t9637147hqnm7bgk000000gn/T//St95094.000004 saved
    as .dta format

. restore

. append using `empty_vars2'

. timer off 7

. timer list 7
   7:     13.59 /        1 =      13.5900

. drop v0-v23

. 
. * ===========================================================================
> =
. * Summary
. * ===========================================================================
> =
. di _n "========================================"

========================================

. di "SUMMARY"
SUMMARY

. di "========================================"
========================================

. timer list 1
   1:     18.19 /        1 =      18.1930

. timer list 2
   2:     11.40 /        1 =      11.3970

. timer list 3
   3:     11.21 /        1 =      11.2080

. timer list 4
   4:     11.62 /        1 =      11.6240

. timer list 5
   5:     11.21 /        1 =      11.2120

. timer list 6
   6:      2.48 /        1 =       2.4760

. timer list 7
   7:     13.59 /        1 =      13.5900

. 
end of do-file

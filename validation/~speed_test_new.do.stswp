*===============================================================================
* Speed benchmarks
*===============================================================================

* Warm up ctools to load plugin before benchmarks
sysuse auto, clear
csort price

* List of obs
local n_obs_list 1e5 1e6 1e7 1e8

* Setup: matrix to store results and track current row
matrix A = J(4,5,.)
local current = 1

* Iterate over obs counts
foreach N in `n_obs_list' {
	
	* Create dataset
	clear
	set obs `=`N''
	forval i=1/10 {
		gen float`i' = rnormal()
	}
	forval i=1/5 {
		gen int`i' = ceil(runiform()*1000) 
	}
	tempfile t1
	save `t1'
	
	* Sort times
	timer on 1
	sort float1
	timer off 1
	
	timer on 2
	sort int1
	timer off 2
	
	* Csort times
	timer on 3
	csort float2
	timer off 3
	
	timer on 4
	csort int2
	timer off 4
	
	* Save timers to a row
	qui timer list
	mat A[`current',1] = `N'
	mat A[`current',2] = r(t1)
	mat A[`current',3] = r(t2)
	mat A[`current',4] = r(t3)
	mat A[`current',5] = r(t4)
	timer clear
	local current = `current' + 1
	
}

clear
svmat A
rename (A1 A2 A3 A4 A5) (n_obs time_sort_float time_sort_int time_csort_float time_csort_int)
gen relative_time_float = time_sort_float/time_csort_float
gen relative_time_int = time_sort_int/time_csort_int

twoway (scatter relative_time_float n_obs)

/*==============
 SPEED TEST 2
 */

clear all
set obs 50000000
forval i=1/20 {
	gen x`i' = rnormal()
}
sort x1
csort x2, verbose